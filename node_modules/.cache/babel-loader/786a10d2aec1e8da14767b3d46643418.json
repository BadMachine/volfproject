{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.newState = exports.STATE = exports.AbstractMathItem = exports.protoItem = void 0;\n\nfunction protoItem(open, math, close, n, start, end, display) {\n  if (display === void 0) {\n    display = null;\n  }\n\n  var item = {\n    open: open,\n    math: math,\n    close: close,\n    n: n,\n    start: {\n      n: start\n    },\n    end: {\n      n: end\n    },\n    display: display\n  };\n  return item;\n}\n\nexports.protoItem = protoItem;\n\nvar AbstractMathItem = function () {\n  function AbstractMathItem(math, jax, display, start, end) {\n    if (display === void 0) {\n      display = true;\n    }\n\n    if (start === void 0) {\n      start = {\n        i: 0,\n        n: 0,\n        delim: ''\n      };\n    }\n\n    if (end === void 0) {\n      end = {\n        i: 0,\n        n: 0,\n        delim: ''\n      };\n    }\n\n    this.root = null;\n    this.typesetRoot = null;\n    this.metrics = {};\n    this.inputData = {};\n    this.outputData = {};\n    this._state = exports.STATE.UNPROCESSED;\n    this.math = math;\n    this.inputJax = jax;\n    this.display = display;\n    this.start = start;\n    this.end = end;\n    this.root = null;\n    this.typesetRoot = null;\n    this.metrics = {};\n    this.inputData = {};\n    this.outputData = {};\n  }\n\n  Object.defineProperty(AbstractMathItem.prototype, \"isEscaped\", {\n    get: function () {\n      return this.display === null;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  AbstractMathItem.prototype.render = function (document) {\n    document.renderActions.renderMath(this, document);\n  };\n\n  AbstractMathItem.prototype.rerender = function (document, start) {\n    if (start === void 0) {\n      start = exports.STATE.RERENDER;\n    }\n\n    if (this.state() >= start) {\n      this.state(start - 1);\n    }\n\n    document.renderActions.renderMath(this, document, start);\n  };\n\n  AbstractMathItem.prototype.convert = function (document, end) {\n    if (end === void 0) {\n      end = exports.STATE.LAST;\n    }\n\n    document.renderActions.renderConvert(this, document, end);\n  };\n\n  AbstractMathItem.prototype.compile = function (document) {\n    if (this.state() < exports.STATE.COMPILED) {\n      this.root = this.inputJax.compile(this, document);\n      this.state(exports.STATE.COMPILED);\n    }\n  };\n\n  AbstractMathItem.prototype.typeset = function (document) {\n    if (this.state() < exports.STATE.TYPESET) {\n      this.typesetRoot = document.outputJax[this.isEscaped ? 'escaped' : 'typeset'](this, document);\n      this.state(exports.STATE.TYPESET);\n    }\n  };\n\n  AbstractMathItem.prototype.updateDocument = function (_document) {};\n\n  AbstractMathItem.prototype.removeFromDocument = function (_restore) {\n    if (_restore === void 0) {\n      _restore = false;\n    }\n  };\n\n  AbstractMathItem.prototype.setMetrics = function (em, ex, cwidth, lwidth, scale) {\n    this.metrics = {\n      em: em,\n      ex: ex,\n      containerWidth: cwidth,\n      lineWidth: lwidth,\n      scale: scale\n    };\n  };\n\n  AbstractMathItem.prototype.state = function (state, restore) {\n    if (state === void 0) {\n      state = null;\n    }\n\n    if (restore === void 0) {\n      restore = false;\n    }\n\n    if (state != null) {\n      if (state < exports.STATE.INSERTED && this._state >= exports.STATE.INSERTED) {\n        this.removeFromDocument(restore);\n      }\n\n      if (state < exports.STATE.TYPESET && this._state >= exports.STATE.TYPESET) {\n        this.outputData = {};\n      }\n\n      if (state < exports.STATE.COMPILED && this._state >= exports.STATE.COMPILED) {\n        this.inputData = {};\n      }\n\n      this._state = state;\n    }\n\n    return this._state;\n  };\n\n  AbstractMathItem.prototype.reset = function (restore) {\n    if (restore === void 0) {\n      restore = false;\n    }\n\n    this.state(exports.STATE.UNPROCESSED, restore);\n  };\n\n  return AbstractMathItem;\n}();\n\nexports.AbstractMathItem = AbstractMathItem;\nexports.STATE = {\n  UNPROCESSED: 0,\n  FINDMATH: 10,\n  COMPILED: 20,\n  CONVERT: 100,\n  METRICS: 110,\n  RERENDER: 125,\n  TYPESET: 150,\n  INSERTED: 200,\n  LAST: 10000\n};\n\nfunction newState(name, state) {\n  if (name in exports.STATE) {\n    throw Error('State ' + name + ' already exists');\n  }\n\n  exports.STATE[name] = state;\n}\n\nexports.newState = newState;","map":{"version":3,"sources":["../../ts/core/MathItem.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.newState = exports.STATE = exports.AbstractMathItem = exports.protoItem = void 0;\nfunction protoItem(open, math, close, n, start, end, display) {\n    if (display === void 0) { display = null; }\n    var item = { open: open, math: math, close: close,\n        n: n, start: { n: start }, end: { n: end }, display: display };\n    return item;\n}\nexports.protoItem = protoItem;\nvar AbstractMathItem = (function () {\n    function AbstractMathItem(math, jax, display, start, end) {\n        if (display === void 0) { display = true; }\n        if (start === void 0) { start = { i: 0, n: 0, delim: '' }; }\n        if (end === void 0) { end = { i: 0, n: 0, delim: '' }; }\n        this.root = null;\n        this.typesetRoot = null;\n        this.metrics = {};\n        this.inputData = {};\n        this.outputData = {};\n        this._state = exports.STATE.UNPROCESSED;\n        this.math = math;\n        this.inputJax = jax;\n        this.display = display;\n        this.start = start;\n        this.end = end;\n        this.root = null;\n        this.typesetRoot = null;\n        this.metrics = {};\n        this.inputData = {};\n        this.outputData = {};\n    }\n    Object.defineProperty(AbstractMathItem.prototype, \"isEscaped\", {\n        get: function () {\n            return this.display === null;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    AbstractMathItem.prototype.render = function (document) {\n        document.renderActions.renderMath(this, document);\n    };\n    AbstractMathItem.prototype.rerender = function (document, start) {\n        if (start === void 0) { start = exports.STATE.RERENDER; }\n        if (this.state() >= start) {\n            this.state(start - 1);\n        }\n        document.renderActions.renderMath(this, document, start);\n    };\n    AbstractMathItem.prototype.convert = function (document, end) {\n        if (end === void 0) { end = exports.STATE.LAST; }\n        document.renderActions.renderConvert(this, document, end);\n    };\n    AbstractMathItem.prototype.compile = function (document) {\n        if (this.state() < exports.STATE.COMPILED) {\n            this.root = this.inputJax.compile(this, document);\n            this.state(exports.STATE.COMPILED);\n        }\n    };\n    AbstractMathItem.prototype.typeset = function (document) {\n        if (this.state() < exports.STATE.TYPESET) {\n            this.typesetRoot = document.outputJax[this.isEscaped ? 'escaped' : 'typeset'](this, document);\n            this.state(exports.STATE.TYPESET);\n        }\n    };\n    AbstractMathItem.prototype.updateDocument = function (_document) { };\n    AbstractMathItem.prototype.removeFromDocument = function (_restore) {\n        if (_restore === void 0) { _restore = false; }\n    };\n    AbstractMathItem.prototype.setMetrics = function (em, ex, cwidth, lwidth, scale) {\n        this.metrics = {\n            em: em, ex: ex,\n            containerWidth: cwidth,\n            lineWidth: lwidth,\n            scale: scale\n        };\n    };\n    AbstractMathItem.prototype.state = function (state, restore) {\n        if (state === void 0) { state = null; }\n        if (restore === void 0) { restore = false; }\n        if (state != null) {\n            if (state < exports.STATE.INSERTED && this._state >= exports.STATE.INSERTED) {\n                this.removeFromDocument(restore);\n            }\n            if (state < exports.STATE.TYPESET && this._state >= exports.STATE.TYPESET) {\n                this.outputData = {};\n            }\n            if (state < exports.STATE.COMPILED && this._state >= exports.STATE.COMPILED) {\n                this.inputData = {};\n            }\n            this._state = state;\n        }\n        return this._state;\n    };\n    AbstractMathItem.prototype.reset = function (restore) {\n        if (restore === void 0) { restore = false; }\n        this.state(exports.STATE.UNPROCESSED, restore);\n    };\n    return AbstractMathItem;\n}());\nexports.AbstractMathItem = AbstractMathItem;\nexports.STATE = {\n    UNPROCESSED: 0,\n    FINDMATH: 10,\n    COMPILED: 20,\n    CONVERT: 100,\n    METRICS: 110,\n    RERENDER: 125,\n    TYPESET: 150,\n    INSERTED: 200,\n    LAST: 10000\n};\nfunction newState(name, state) {\n    if (name in exports.STATE) {\n        throw Error('State ' + name + ' already exists');\n    }\n    exports.STATE[name] = state;\n}\nexports.newState = newState;\n//# sourceMappingURL=MathItem.js.map"]},"metadata":{},"sourceType":"script"}