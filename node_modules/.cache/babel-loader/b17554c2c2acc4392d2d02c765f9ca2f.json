{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HTMLDocument = void 0;\n\nvar MathDocument_js_1 = require(\"../../core/MathDocument.js\");\n\nvar Options_js_1 = require(\"../../util/Options.js\");\n\nvar HTMLMathItem_js_1 = require(\"./HTMLMathItem.js\");\n\nvar HTMLMathList_js_1 = require(\"./HTMLMathList.js\");\n\nvar HTMLDomStrings_js_1 = require(\"./HTMLDomStrings.js\");\n\nvar MathItem_js_1 = require(\"../../core/MathItem.js\");\n\nvar HTMLDocument = function (_super) {\n  __extends(HTMLDocument, _super);\n\n  function HTMLDocument(document, adaptor, options) {\n    var _this = this;\n\n    var _a = __read(Options_js_1.separateOptions(options, HTMLDomStrings_js_1.HTMLDomStrings.OPTIONS), 2),\n        html = _a[0],\n        dom = _a[1];\n\n    _this = _super.call(this, document, adaptor, html) || this;\n    _this.domStrings = _this.options['DomStrings'] || new HTMLDomStrings_js_1.HTMLDomStrings(dom);\n    _this.domStrings.adaptor = adaptor;\n    _this.styles = [];\n    return _this;\n  }\n\n  HTMLDocument.prototype.findPosition = function (N, index, delim, nodes) {\n    var e_1, _a;\n\n    var adaptor = this.adaptor;\n\n    try {\n      for (var _b = __values(nodes[N]), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var list = _c.value;\n\n        var _d = __read(list, 2),\n            node = _d[0],\n            n = _d[1];\n\n        if (index <= n && adaptor.kind(node) === '#text') {\n          return {\n            node: node,\n            n: Math.max(index, 0),\n            delim: delim\n          };\n        }\n\n        index -= n;\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    return {\n      node: null,\n      n: 0,\n      delim: delim\n    };\n  };\n\n  HTMLDocument.prototype.mathItem = function (item, jax, nodes) {\n    var math = item.math;\n    var start = this.findPosition(item.n, item.start.n, item.open, nodes);\n    var end = this.findPosition(item.n, item.end.n, item.close, nodes);\n    return new this.options.MathItem(math, jax, item.display, start, end);\n  };\n\n  HTMLDocument.prototype.findMath = function (options) {\n    var e_2, _a, e_3, _b, _c, e_4, _d, e_5, _e;\n\n    if (!this.processed.isSet('findMath')) {\n      this.adaptor.document = this.document;\n      options = Options_js_1.userOptions({\n        elements: this.options.elements || [this.adaptor.body(this.document)]\n      }, options);\n\n      try {\n        for (var _f = __values(this.adaptor.getElements(options['elements'], this.document)), _g = _f.next(); !_g.done; _g = _f.next()) {\n          var container = _g.value;\n\n          var _h = __read([null, null], 2),\n              strings = _h[0],\n              nodes = _h[1];\n\n          try {\n            for (var _j = (e_3 = void 0, __values(this.inputJax)), _k = _j.next(); !_k.done; _k = _j.next()) {\n              var jax = _k.value;\n              var list = new this.options['MathList']();\n\n              if (jax.processStrings) {\n                if (strings === null) {\n                  _c = __read(this.domStrings.find(container), 2), strings = _c[0], nodes = _c[1];\n                }\n\n                try {\n                  for (var _l = (e_4 = void 0, __values(jax.findMath(strings))), _m = _l.next(); !_m.done; _m = _l.next()) {\n                    var math = _m.value;\n                    list.push(this.mathItem(math, jax, nodes));\n                  }\n                } catch (e_4_1) {\n                  e_4 = {\n                    error: e_4_1\n                  };\n                } finally {\n                  try {\n                    if (_m && !_m.done && (_d = _l.return)) _d.call(_l);\n                  } finally {\n                    if (e_4) throw e_4.error;\n                  }\n                }\n              } else {\n                try {\n                  for (var _o = (e_5 = void 0, __values(jax.findMath(container))), _p = _o.next(); !_p.done; _p = _o.next()) {\n                    var math = _p.value;\n                    var item = new this.options.MathItem(math.math, jax, math.display, math.start, math.end);\n                    list.push(item);\n                  }\n                } catch (e_5_1) {\n                  e_5 = {\n                    error: e_5_1\n                  };\n                } finally {\n                  try {\n                    if (_p && !_p.done && (_e = _o.return)) _e.call(_o);\n                  } finally {\n                    if (e_5) throw e_5.error;\n                  }\n                }\n              }\n\n              this.math.merge(list);\n            }\n          } catch (e_3_1) {\n            e_3 = {\n              error: e_3_1\n            };\n          } finally {\n            try {\n              if (_k && !_k.done && (_b = _j.return)) _b.call(_j);\n            } finally {\n              if (e_3) throw e_3.error;\n            }\n          }\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n\n      this.processed.set('findMath');\n    }\n\n    return this;\n  };\n\n  HTMLDocument.prototype.updateDocument = function () {\n    if (!this.processed.isSet('updateDocument')) {\n      this.addPageElements();\n      this.addStyleSheet();\n\n      _super.prototype.updateDocument.call(this);\n\n      this.processed.set('updateDocument');\n    }\n\n    return this;\n  };\n\n  HTMLDocument.prototype.addPageElements = function () {\n    var body = this.adaptor.body(this.document);\n    var node = this.documentPageElements();\n\n    if (node) {\n      this.adaptor.append(body, node);\n    }\n  };\n\n  HTMLDocument.prototype.addStyleSheet = function () {\n    var sheet = this.documentStyleSheet();\n\n    if (sheet) {\n      var head = this.adaptor.head(this.document);\n      var styles = this.findSheet(head, this.adaptor.getAttribute(sheet, 'id'));\n\n      if (styles) {\n        this.adaptor.replace(sheet, styles);\n      } else {\n        this.adaptor.append(head, sheet);\n      }\n    }\n  };\n\n  HTMLDocument.prototype.findSheet = function (head, id) {\n    var e_6, _a;\n\n    if (id) {\n      try {\n        for (var _b = __values(this.adaptor.tags(head, 'style')), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var sheet = _c.value;\n\n          if (this.adaptor.getAttribute(sheet, 'id') === id) {\n            return sheet;\n          }\n        }\n      } catch (e_6_1) {\n        e_6 = {\n          error: e_6_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_6) throw e_6.error;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  HTMLDocument.prototype.removeFromDocument = function (restore) {\n    var e_7, _a;\n\n    if (restore === void 0) {\n      restore = false;\n    }\n\n    if (this.processed.isSet('updateDocument')) {\n      try {\n        for (var _b = __values(this.math), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var math = _c.value;\n\n          if (math.state() >= MathItem_js_1.STATE.INSERTED) {\n            math.state(MathItem_js_1.STATE.TYPESET, restore);\n          }\n        }\n      } catch (e_7_1) {\n        e_7 = {\n          error: e_7_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_7) throw e_7.error;\n        }\n      }\n    }\n\n    this.processed.clear('updateDocument');\n    return this;\n  };\n\n  HTMLDocument.prototype.documentStyleSheet = function () {\n    return this.outputJax.styleSheet(this);\n  };\n\n  HTMLDocument.prototype.documentPageElements = function () {\n    return this.outputJax.pageElements(this);\n  };\n\n  HTMLDocument.prototype.addStyles = function (styles) {\n    this.styles.push(styles);\n  };\n\n  HTMLDocument.prototype.getStyles = function () {\n    return this.styles;\n  };\n\n  HTMLDocument.KIND = 'HTML';\n  HTMLDocument.OPTIONS = __assign(__assign({}, MathDocument_js_1.AbstractMathDocument.OPTIONS), {\n    renderActions: Options_js_1.expandable(__assign(__assign({}, MathDocument_js_1.AbstractMathDocument.OPTIONS.renderActions), {\n      styles: [MathItem_js_1.STATE.INSERTED + 1, '', 'updateStyleSheet', false]\n    })),\n    MathList: HTMLMathList_js_1.HTMLMathList,\n    MathItem: HTMLMathItem_js_1.HTMLMathItem,\n    DomStrings: null\n  });\n  return HTMLDocument;\n}(MathDocument_js_1.AbstractMathDocument);\n\nexports.HTMLDocument = HTMLDocument;","map":{"version":3,"sources":["../../../ts/handlers/html/HTMLDocument.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HTMLDocument = void 0;\nvar MathDocument_js_1 = require(\"../../core/MathDocument.js\");\nvar Options_js_1 = require(\"../../util/Options.js\");\nvar HTMLMathItem_js_1 = require(\"./HTMLMathItem.js\");\nvar HTMLMathList_js_1 = require(\"./HTMLMathList.js\");\nvar HTMLDomStrings_js_1 = require(\"./HTMLDomStrings.js\");\nvar MathItem_js_1 = require(\"../../core/MathItem.js\");\nvar HTMLDocument = (function (_super) {\n    __extends(HTMLDocument, _super);\n    function HTMLDocument(document, adaptor, options) {\n        var _this = this;\n        var _a = __read(Options_js_1.separateOptions(options, HTMLDomStrings_js_1.HTMLDomStrings.OPTIONS), 2), html = _a[0], dom = _a[1];\n        _this = _super.call(this, document, adaptor, html) || this;\n        _this.domStrings = _this.options['DomStrings'] || new HTMLDomStrings_js_1.HTMLDomStrings(dom);\n        _this.domStrings.adaptor = adaptor;\n        _this.styles = [];\n        return _this;\n    }\n    HTMLDocument.prototype.findPosition = function (N, index, delim, nodes) {\n        var e_1, _a;\n        var adaptor = this.adaptor;\n        try {\n            for (var _b = __values(nodes[N]), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var list = _c.value;\n                var _d = __read(list, 2), node = _d[0], n = _d[1];\n                if (index <= n && adaptor.kind(node) === '#text') {\n                    return { node: node, n: Math.max(index, 0), delim: delim };\n                }\n                index -= n;\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        return { node: null, n: 0, delim: delim };\n    };\n    HTMLDocument.prototype.mathItem = function (item, jax, nodes) {\n        var math = item.math;\n        var start = this.findPosition(item.n, item.start.n, item.open, nodes);\n        var end = this.findPosition(item.n, item.end.n, item.close, nodes);\n        return new this.options.MathItem(math, jax, item.display, start, end);\n    };\n    HTMLDocument.prototype.findMath = function (options) {\n        var e_2, _a, e_3, _b, _c, e_4, _d, e_5, _e;\n        if (!this.processed.isSet('findMath')) {\n            this.adaptor.document = this.document;\n            options = Options_js_1.userOptions({ elements: this.options.elements || [this.adaptor.body(this.document)] }, options);\n            try {\n                for (var _f = __values(this.adaptor.getElements(options['elements'], this.document)), _g = _f.next(); !_g.done; _g = _f.next()) {\n                    var container = _g.value;\n                    var _h = __read([null, null], 2), strings = _h[0], nodes = _h[1];\n                    try {\n                        for (var _j = (e_3 = void 0, __values(this.inputJax)), _k = _j.next(); !_k.done; _k = _j.next()) {\n                            var jax = _k.value;\n                            var list = new (this.options['MathList'])();\n                            if (jax.processStrings) {\n                                if (strings === null) {\n                                    _c = __read(this.domStrings.find(container), 2), strings = _c[0], nodes = _c[1];\n                                }\n                                try {\n                                    for (var _l = (e_4 = void 0, __values(jax.findMath(strings))), _m = _l.next(); !_m.done; _m = _l.next()) {\n                                        var math = _m.value;\n                                        list.push(this.mathItem(math, jax, nodes));\n                                    }\n                                }\n                                catch (e_4_1) { e_4 = { error: e_4_1 }; }\n                                finally {\n                                    try {\n                                        if (_m && !_m.done && (_d = _l.return)) _d.call(_l);\n                                    }\n                                    finally { if (e_4) throw e_4.error; }\n                                }\n                            }\n                            else {\n                                try {\n                                    for (var _o = (e_5 = void 0, __values(jax.findMath(container))), _p = _o.next(); !_p.done; _p = _o.next()) {\n                                        var math = _p.value;\n                                        var item = new this.options.MathItem(math.math, jax, math.display, math.start, math.end);\n                                        list.push(item);\n                                    }\n                                }\n                                catch (e_5_1) { e_5 = { error: e_5_1 }; }\n                                finally {\n                                    try {\n                                        if (_p && !_p.done && (_e = _o.return)) _e.call(_o);\n                                    }\n                                    finally { if (e_5) throw e_5.error; }\n                                }\n                            }\n                            this.math.merge(list);\n                        }\n                    }\n                    catch (e_3_1) { e_3 = { error: e_3_1 }; }\n                    finally {\n                        try {\n                            if (_k && !_k.done && (_b = _j.return)) _b.call(_j);\n                        }\n                        finally { if (e_3) throw e_3.error; }\n                    }\n                }\n            }\n            catch (e_2_1) { e_2 = { error: e_2_1 }; }\n            finally {\n                try {\n                    if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n                }\n                finally { if (e_2) throw e_2.error; }\n            }\n            this.processed.set('findMath');\n        }\n        return this;\n    };\n    HTMLDocument.prototype.updateDocument = function () {\n        if (!this.processed.isSet('updateDocument')) {\n            this.addPageElements();\n            this.addStyleSheet();\n            _super.prototype.updateDocument.call(this);\n            this.processed.set('updateDocument');\n        }\n        return this;\n    };\n    HTMLDocument.prototype.addPageElements = function () {\n        var body = this.adaptor.body(this.document);\n        var node = this.documentPageElements();\n        if (node) {\n            this.adaptor.append(body, node);\n        }\n    };\n    HTMLDocument.prototype.addStyleSheet = function () {\n        var sheet = this.documentStyleSheet();\n        if (sheet) {\n            var head = this.adaptor.head(this.document);\n            var styles = this.findSheet(head, this.adaptor.getAttribute(sheet, 'id'));\n            if (styles) {\n                this.adaptor.replace(sheet, styles);\n            }\n            else {\n                this.adaptor.append(head, sheet);\n            }\n        }\n    };\n    HTMLDocument.prototype.findSheet = function (head, id) {\n        var e_6, _a;\n        if (id) {\n            try {\n                for (var _b = __values(this.adaptor.tags(head, 'style')), _c = _b.next(); !_c.done; _c = _b.next()) {\n                    var sheet = _c.value;\n                    if (this.adaptor.getAttribute(sheet, 'id') === id) {\n                        return sheet;\n                    }\n                }\n            }\n            catch (e_6_1) { e_6 = { error: e_6_1 }; }\n            finally {\n                try {\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                }\n                finally { if (e_6) throw e_6.error; }\n            }\n        }\n        return null;\n    };\n    HTMLDocument.prototype.removeFromDocument = function (restore) {\n        var e_7, _a;\n        if (restore === void 0) { restore = false; }\n        if (this.processed.isSet('updateDocument')) {\n            try {\n                for (var _b = __values(this.math), _c = _b.next(); !_c.done; _c = _b.next()) {\n                    var math = _c.value;\n                    if (math.state() >= MathItem_js_1.STATE.INSERTED) {\n                        math.state(MathItem_js_1.STATE.TYPESET, restore);\n                    }\n                }\n            }\n            catch (e_7_1) { e_7 = { error: e_7_1 }; }\n            finally {\n                try {\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                }\n                finally { if (e_7) throw e_7.error; }\n            }\n        }\n        this.processed.clear('updateDocument');\n        return this;\n    };\n    HTMLDocument.prototype.documentStyleSheet = function () {\n        return this.outputJax.styleSheet(this);\n    };\n    HTMLDocument.prototype.documentPageElements = function () {\n        return this.outputJax.pageElements(this);\n    };\n    HTMLDocument.prototype.addStyles = function (styles) {\n        this.styles.push(styles);\n    };\n    HTMLDocument.prototype.getStyles = function () {\n        return this.styles;\n    };\n    HTMLDocument.KIND = 'HTML';\n    HTMLDocument.OPTIONS = __assign(__assign({}, MathDocument_js_1.AbstractMathDocument.OPTIONS), { renderActions: Options_js_1.expandable(__assign(__assign({}, MathDocument_js_1.AbstractMathDocument.OPTIONS.renderActions), { styles: [MathItem_js_1.STATE.INSERTED + 1, '', 'updateStyleSheet', false] })), MathList: HTMLMathList_js_1.HTMLMathList, MathItem: HTMLMathItem_js_1.HTMLMathItem, DomStrings: null });\n    return HTMLDocument;\n}(MathDocument_js_1.AbstractMathDocument));\nexports.HTMLDocument = HTMLDocument;\n//# sourceMappingURL=HTMLDocument.js.map"]},"metadata":{},"sourceType":"script"}