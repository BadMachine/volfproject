{"ast":null,"code":"\"use strict\";\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HTMLDomStrings = void 0;\n\nvar Options_js_1 = require(\"../../util/Options.js\");\n\nvar HTMLDomStrings = function () {\n  function HTMLDomStrings(options) {\n    if (options === void 0) {\n      options = null;\n    }\n\n    var CLASS = this.constructor;\n    this.options = Options_js_1.userOptions(Options_js_1.defaultOptions({}, CLASS.OPTIONS), options);\n    this.init();\n    this.getPatterns();\n  }\n\n  HTMLDomStrings.prototype.init = function () {\n    this.strings = [];\n    this.string = '';\n    this.snodes = [];\n    this.nodes = [];\n    this.stack = [];\n  };\n\n  HTMLDomStrings.prototype.getPatterns = function () {\n    var skip = Options_js_1.makeArray(this.options['skipHtmlTags']);\n    var ignore = Options_js_1.makeArray(this.options['ignoreHtmlClass']);\n    var process = Options_js_1.makeArray(this.options['processHtmlClass']);\n    this.skipHtmlTags = new RegExp('^(?:' + skip.join('|') + ')$', 'i');\n    this.ignoreHtmlClass = new RegExp('(?:^| )(?:' + ignore.join('|') + ')(?: |$)');\n    this.processHtmlClass = new RegExp('(?:^| )(?:' + process + ')(?: |$)');\n  };\n\n  HTMLDomStrings.prototype.pushString = function () {\n    if (this.string.match(/\\S/)) {\n      this.strings.push(this.string);\n      this.nodes.push(this.snodes);\n    }\n\n    this.string = '';\n    this.snodes = [];\n  };\n\n  HTMLDomStrings.prototype.extendString = function (node, text) {\n    this.snodes.push([node, text.length]);\n    this.string += text;\n  };\n\n  HTMLDomStrings.prototype.handleText = function (node, ignore) {\n    if (!ignore) {\n      this.extendString(node, this.adaptor.value(node));\n    }\n\n    return this.adaptor.next(node);\n  };\n\n  HTMLDomStrings.prototype.handleTag = function (node, ignore) {\n    if (!ignore) {\n      var text = this.options['includeHtmlTags'][this.adaptor.kind(node)];\n      this.extendString(node, text);\n    }\n\n    return this.adaptor.next(node);\n  };\n\n  HTMLDomStrings.prototype.handleContainer = function (node, ignore) {\n    this.pushString();\n    var cname = this.adaptor.getAttribute(node, 'class') || '';\n    var tname = this.adaptor.kind(node) || '';\n    var process = this.processHtmlClass.exec(cname);\n    var next = node;\n\n    if (this.adaptor.firstChild(node) && !this.adaptor.getAttribute(node, 'data-MJX') && (process || !this.skipHtmlTags.exec(tname))) {\n      if (this.adaptor.next(node)) {\n        this.stack.push([this.adaptor.next(node), ignore]);\n      }\n\n      next = this.adaptor.firstChild(node);\n      ignore = (ignore || this.ignoreHtmlClass.exec(cname)) && !process;\n    } else {\n      next = this.adaptor.next(node);\n    }\n\n    return [next, ignore];\n  };\n\n  HTMLDomStrings.prototype.find = function (node) {\n    var _a, _b;\n\n    this.init();\n    var stop = this.adaptor.next(node);\n    var ignore = false;\n    var include = this.options['includeHtmlTags'];\n\n    while (node && node !== stop) {\n      if (this.adaptor.kind(node) === '#text') {\n        node = this.handleText(node, ignore);\n      } else if (include[this.adaptor.kind(node)] !== undefined) {\n        node = this.handleTag(node, ignore);\n      } else {\n        _a = __read(this.handleContainer(node, ignore), 2), node = _a[0], ignore = _a[1];\n      }\n\n      if (!node && this.stack.length) {\n        this.pushString();\n        _b = __read(this.stack.pop(), 2), node = _b[0], ignore = _b[1];\n      }\n    }\n\n    this.pushString();\n    var result = [this.strings, this.nodes];\n    this.init();\n    return result;\n  };\n\n  HTMLDomStrings.OPTIONS = {\n    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'annotation', 'annotation-xml'],\n    includeHtmlTags: {\n      br: '\\n',\n      wbr: '',\n      '#comment': ''\n    },\n    ignoreHtmlClass: 'mathjax_ignore',\n    processHtmlClass: 'mathjax_process'\n  };\n  return HTMLDomStrings;\n}();\n\nexports.HTMLDomStrings = HTMLDomStrings;","map":{"version":3,"sources":["../../../ts/handlers/html/HTMLDomStrings.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HTMLDomStrings = void 0;\nvar Options_js_1 = require(\"../../util/Options.js\");\nvar HTMLDomStrings = (function () {\n    function HTMLDomStrings(options) {\n        if (options === void 0) { options = null; }\n        var CLASS = this.constructor;\n        this.options = Options_js_1.userOptions(Options_js_1.defaultOptions({}, CLASS.OPTIONS), options);\n        this.init();\n        this.getPatterns();\n    }\n    HTMLDomStrings.prototype.init = function () {\n        this.strings = [];\n        this.string = '';\n        this.snodes = [];\n        this.nodes = [];\n        this.stack = [];\n    };\n    HTMLDomStrings.prototype.getPatterns = function () {\n        var skip = Options_js_1.makeArray(this.options['skipHtmlTags']);\n        var ignore = Options_js_1.makeArray(this.options['ignoreHtmlClass']);\n        var process = Options_js_1.makeArray(this.options['processHtmlClass']);\n        this.skipHtmlTags = new RegExp('^(?:' + skip.join('|') + ')$', 'i');\n        this.ignoreHtmlClass = new RegExp('(?:^| )(?:' + ignore.join('|') + ')(?: |$)');\n        this.processHtmlClass = new RegExp('(?:^| )(?:' + process + ')(?: |$)');\n    };\n    HTMLDomStrings.prototype.pushString = function () {\n        if (this.string.match(/\\S/)) {\n            this.strings.push(this.string);\n            this.nodes.push(this.snodes);\n        }\n        this.string = '';\n        this.snodes = [];\n    };\n    HTMLDomStrings.prototype.extendString = function (node, text) {\n        this.snodes.push([node, text.length]);\n        this.string += text;\n    };\n    HTMLDomStrings.prototype.handleText = function (node, ignore) {\n        if (!ignore) {\n            this.extendString(node, this.adaptor.value(node));\n        }\n        return this.adaptor.next(node);\n    };\n    HTMLDomStrings.prototype.handleTag = function (node, ignore) {\n        if (!ignore) {\n            var text = this.options['includeHtmlTags'][this.adaptor.kind(node)];\n            this.extendString(node, text);\n        }\n        return this.adaptor.next(node);\n    };\n    HTMLDomStrings.prototype.handleContainer = function (node, ignore) {\n        this.pushString();\n        var cname = this.adaptor.getAttribute(node, 'class') || '';\n        var tname = this.adaptor.kind(node) || '';\n        var process = this.processHtmlClass.exec(cname);\n        var next = node;\n        if (this.adaptor.firstChild(node) && !this.adaptor.getAttribute(node, 'data-MJX') &&\n            (process || !this.skipHtmlTags.exec(tname))) {\n            if (this.adaptor.next(node)) {\n                this.stack.push([this.adaptor.next(node), ignore]);\n            }\n            next = this.adaptor.firstChild(node);\n            ignore = (ignore || this.ignoreHtmlClass.exec(cname)) && !process;\n        }\n        else {\n            next = this.adaptor.next(node);\n        }\n        return [next, ignore];\n    };\n    HTMLDomStrings.prototype.find = function (node) {\n        var _a, _b;\n        this.init();\n        var stop = this.adaptor.next(node);\n        var ignore = false;\n        var include = this.options['includeHtmlTags'];\n        while (node && node !== stop) {\n            if (this.adaptor.kind(node) === '#text') {\n                node = this.handleText(node, ignore);\n            }\n            else if (include[this.adaptor.kind(node)] !== undefined) {\n                node = this.handleTag(node, ignore);\n            }\n            else {\n                _a = __read(this.handleContainer(node, ignore), 2), node = _a[0], ignore = _a[1];\n            }\n            if (!node && this.stack.length) {\n                this.pushString();\n                _b = __read(this.stack.pop(), 2), node = _b[0], ignore = _b[1];\n            }\n        }\n        this.pushString();\n        var result = [this.strings, this.nodes];\n        this.init();\n        return result;\n    };\n    HTMLDomStrings.OPTIONS = {\n        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'annotation', 'annotation-xml'],\n        includeHtmlTags: { br: '\\n', wbr: '', '#comment': '' },\n        ignoreHtmlClass: 'mathjax_ignore',\n        processHtmlClass: 'mathjax_process'\n    };\n    return HTMLDomStrings;\n}());\nexports.HTMLDomStrings = HTMLDomStrings;\n//# sourceMappingURL=HTMLDomStrings.js.map"]},"metadata":{},"sourceType":"script"}