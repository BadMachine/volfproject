{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar _a;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommonMoMixin = exports.DirectionVH = void 0;\n\nvar FontData_js_1 = require(\"../FontData.js\");\n\nexports.DirectionVH = (_a = {}, _a[1] = 'v', _a[2] = 'h', _a);\n\nfunction CommonMoMixin(Base) {\n  return function (_super) {\n    __extends(class_1, _super);\n\n    function class_1() {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var _this = _super.apply(this, __spread(args)) || this;\n\n      _this.noIC = false;\n      _this.size = null;\n      _this.isAccent = _this.node.isAccent;\n      return _this;\n    }\n\n    class_1.prototype.computeBBox = function (bbox, _recompute) {\n      if (_recompute === void 0) {\n        _recompute = false;\n      }\n\n      var stretchy = this.stretch.dir !== 0;\n\n      if (stretchy && this.size === null) {\n        this.getStretchedVariant([0]);\n      }\n\n      if (stretchy && this.size < 0) return;\n\n      _super.prototype.computeBBox.call(this, bbox);\n\n      this.copySkewIC(bbox);\n\n      if (this.noIC) {\n        bbox.w -= bbox.ic;\n      }\n\n      if (this.node.attributes.get('symmetric') && this.stretch.dir !== 2) {\n        var d = (bbox.h + bbox.d) / 2 + this.font.params.axis_height - bbox.h;\n        bbox.h += d;\n        bbox.d -= d;\n      }\n    };\n\n    class_1.prototype.getVariant = function () {\n      if (this.node.attributes.get('largeop')) {\n        this.variant = this.node.attributes.get('displaystyle') ? '-largeop' : '-smallop';\n      } else {\n        _super.prototype.getVariant.call(this);\n      }\n    };\n\n    class_1.prototype.canStretch = function (direction) {\n      if (this.stretch.dir !== 0) {\n        return this.stretch.dir === direction;\n      }\n\n      var attributes = this.node.attributes;\n      if (!attributes.get('stretchy')) return false;\n      var c = this.getText();\n      if (Array.from(c).length !== 1) return false;\n      var delim = this.font.getDelimiter(c.codePointAt(0));\n      this.stretch = delim && delim.dir === direction ? delim : FontData_js_1.NOSTRETCH;\n      return this.stretch.dir !== 0;\n    };\n\n    class_1.prototype.getStretchedVariant = function (WH, exact) {\n      var e_1, _a;\n\n      if (exact === void 0) {\n        exact = false;\n      }\n\n      if (this.stretch.dir !== 0) {\n        var D = this.getWH(WH);\n        var min = this.getSize('minsize', 0);\n        var max = this.getSize('maxsize', Infinity);\n        D = Math.max(min, Math.min(max, D));\n        var m = min || exact ? D : Math.max(D * this.font.params.delimiterfactor / 1000, D - this.font.params.delimitershortfall);\n        var delim = this.stretch;\n        var c = delim.c || this.getText().codePointAt(0);\n        var i = 0;\n\n        if (delim.sizes) {\n          try {\n            for (var _b = __values(delim.sizes), _c = _b.next(); !_c.done; _c = _b.next()) {\n              var d = _c.value;\n\n              if (d >= m) {\n                this.variant = this.font.getSizeVariant(c, i);\n                this.size = i;\n                return;\n              }\n\n              i++;\n            }\n          } catch (e_1_1) {\n            e_1 = {\n              error: e_1_1\n            };\n          } finally {\n            try {\n              if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            } finally {\n              if (e_1) throw e_1.error;\n            }\n          }\n        }\n\n        if (delim.stretch) {\n          this.size = -1;\n          this.invalidateBBox();\n          this.getStretchBBox(WH, D, delim);\n        } else {\n          this.variant = this.font.getSizeVariant(c, i - 1);\n          this.size = i - 1;\n        }\n      }\n    };\n\n    class_1.prototype.getSize = function (name, value) {\n      var attributes = this.node.attributes;\n\n      if (attributes.isSet(name)) {\n        value = this.length2em(attributes.get(name), 1, 1);\n      }\n\n      return value;\n    };\n\n    class_1.prototype.getWH = function (WH) {\n      if (WH.length === 0) return 0;\n      if (WH.length === 1) return WH[0];\n\n      var _a = __read(WH, 2),\n          H = _a[0],\n          D = _a[1];\n\n      var a = this.font.params.axis_height;\n      return this.node.attributes.get('symmetric') ? 2 * Math.max(H - a, D + a) : H + D;\n    };\n\n    class_1.prototype.getStretchBBox = function (WHD, D, C) {\n      var _a;\n\n      if (C.hasOwnProperty('min') && C.min > D) {\n        D = C.min;\n      }\n\n      var _b = __read(C.HDW, 3),\n          h = _b[0],\n          d = _b[1],\n          w = _b[2];\n\n      if (this.stretch.dir === 1) {\n        _a = __read(this.getBaseline(WHD, D, C), 2), h = _a[0], d = _a[1];\n      } else {\n        w = D;\n      }\n\n      this.bbox.h = h;\n      this.bbox.d = d;\n      this.bbox.w = w;\n    };\n\n    class_1.prototype.getBaseline = function (WHD, HD, C) {\n      var hasWHD = WHD.length === 2 && WHD[0] + WHD[1] === HD;\n      var symmetric = this.node.attributes.get('symmetric');\n\n      var _a = __read(hasWHD ? WHD : [HD, 0], 2),\n          H = _a[0],\n          D = _a[1];\n\n      var _b = __read([H + D, 0], 2),\n          h = _b[0],\n          d = _b[1];\n\n      if (symmetric) {\n        var a = this.font.params.axis_height;\n\n        if (hasWHD) {\n          h = 2 * Math.max(H - a, D + a);\n        }\n\n        d = h / 2 - a;\n      } else if (hasWHD) {\n        d = D;\n      } else {\n        var _c = __read(C.HDW || [.75, .25], 2),\n            ch = _c[0],\n            cd = _c[1];\n\n        d = cd * (h / (ch + cd));\n      }\n\n      return [h - d, d];\n    };\n\n    class_1.prototype.remapChars = function (chars) {\n      if (chars.length === 1) {\n        var parent_1 = this.node.coreParent().parent;\n        var isAccent = this.isAccent && !parent_1.isKind('mrow');\n        var map = isAccent ? 'accent' : 'mo';\n        var text = this.font.getRemappedChar(map, chars[0]);\n\n        if (text) {\n          chars = this.unicodeChars(text, this.variant);\n        }\n      }\n\n      return chars;\n    };\n\n    return class_1;\n  }(Base);\n}\n\nexports.CommonMoMixin = CommonMoMixin;","map":{"version":3,"sources":["../../../../ts/output/common/Wrappers/mo.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CommonMoMixin = exports.DirectionVH = void 0;\nvar FontData_js_1 = require(\"../FontData.js\");\nexports.DirectionVH = (_a = {},\n    _a[1] = 'v',\n    _a[2] = 'h',\n    _a);\nfunction CommonMoMixin(Base) {\n    return (function (_super) {\n        __extends(class_1, _super);\n        function class_1() {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            var _this = _super.apply(this, __spread(args)) || this;\n            _this.noIC = false;\n            _this.size = null;\n            _this.isAccent = _this.node.isAccent;\n            return _this;\n        }\n        class_1.prototype.computeBBox = function (bbox, _recompute) {\n            if (_recompute === void 0) { _recompute = false; }\n            var stretchy = (this.stretch.dir !== 0);\n            if (stretchy && this.size === null) {\n                this.getStretchedVariant([0]);\n            }\n            if (stretchy && this.size < 0)\n                return;\n            _super.prototype.computeBBox.call(this, bbox);\n            this.copySkewIC(bbox);\n            if (this.noIC) {\n                bbox.w -= bbox.ic;\n            }\n            if (this.node.attributes.get('symmetric') &&\n                this.stretch.dir !== 2) {\n                var d = ((bbox.h + bbox.d) / 2 + this.font.params.axis_height) - bbox.h;\n                bbox.h += d;\n                bbox.d -= d;\n            }\n        };\n        class_1.prototype.getVariant = function () {\n            if (this.node.attributes.get('largeop')) {\n                this.variant = (this.node.attributes.get('displaystyle') ? '-largeop' : '-smallop');\n            }\n            else {\n                _super.prototype.getVariant.call(this);\n            }\n        };\n        class_1.prototype.canStretch = function (direction) {\n            if (this.stretch.dir !== 0) {\n                return this.stretch.dir === direction;\n            }\n            var attributes = this.node.attributes;\n            if (!attributes.get('stretchy'))\n                return false;\n            var c = this.getText();\n            if (Array.from(c).length !== 1)\n                return false;\n            var delim = this.font.getDelimiter(c.codePointAt(0));\n            this.stretch = (delim && delim.dir === direction ? delim : FontData_js_1.NOSTRETCH);\n            return this.stretch.dir !== 0;\n        };\n        class_1.prototype.getStretchedVariant = function (WH, exact) {\n            var e_1, _a;\n            if (exact === void 0) { exact = false; }\n            if (this.stretch.dir !== 0) {\n                var D = this.getWH(WH);\n                var min = this.getSize('minsize', 0);\n                var max = this.getSize('maxsize', Infinity);\n                D = Math.max(min, Math.min(max, D));\n                var m = (min || exact ? D : Math.max(D * this.font.params.delimiterfactor / 1000, D - this.font.params.delimitershortfall));\n                var delim = this.stretch;\n                var c = delim.c || this.getText().codePointAt(0);\n                var i = 0;\n                if (delim.sizes) {\n                    try {\n                        for (var _b = __values(delim.sizes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                            var d = _c.value;\n                            if (d >= m) {\n                                this.variant = this.font.getSizeVariant(c, i);\n                                this.size = i;\n                                return;\n                            }\n                            i++;\n                        }\n                    }\n                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                    finally {\n                        try {\n                            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                        }\n                        finally { if (e_1) throw e_1.error; }\n                    }\n                }\n                if (delim.stretch) {\n                    this.size = -1;\n                    this.invalidateBBox();\n                    this.getStretchBBox(WH, D, delim);\n                }\n                else {\n                    this.variant = this.font.getSizeVariant(c, i - 1);\n                    this.size = i - 1;\n                }\n            }\n        };\n        class_1.prototype.getSize = function (name, value) {\n            var attributes = this.node.attributes;\n            if (attributes.isSet(name)) {\n                value = this.length2em(attributes.get(name), 1, 1);\n            }\n            return value;\n        };\n        class_1.prototype.getWH = function (WH) {\n            if (WH.length === 0)\n                return 0;\n            if (WH.length === 1)\n                return WH[0];\n            var _a = __read(WH, 2), H = _a[0], D = _a[1];\n            var a = this.font.params.axis_height;\n            return (this.node.attributes.get('symmetric') ? 2 * Math.max(H - a, D + a) : H + D);\n        };\n        class_1.prototype.getStretchBBox = function (WHD, D, C) {\n            var _a;\n            if (C.hasOwnProperty('min') && C.min > D) {\n                D = C.min;\n            }\n            var _b = __read(C.HDW, 3), h = _b[0], d = _b[1], w = _b[2];\n            if (this.stretch.dir === 1) {\n                _a = __read(this.getBaseline(WHD, D, C), 2), h = _a[0], d = _a[1];\n            }\n            else {\n                w = D;\n            }\n            this.bbox.h = h;\n            this.bbox.d = d;\n            this.bbox.w = w;\n        };\n        class_1.prototype.getBaseline = function (WHD, HD, C) {\n            var hasWHD = (WHD.length === 2 && WHD[0] + WHD[1] === HD);\n            var symmetric = this.node.attributes.get('symmetric');\n            var _a = __read((hasWHD ? WHD : [HD, 0]), 2), H = _a[0], D = _a[1];\n            var _b = __read([H + D, 0], 2), h = _b[0], d = _b[1];\n            if (symmetric) {\n                var a = this.font.params.axis_height;\n                if (hasWHD) {\n                    h = 2 * Math.max(H - a, D + a);\n                }\n                d = h / 2 - a;\n            }\n            else if (hasWHD) {\n                d = D;\n            }\n            else {\n                var _c = __read((C.HDW || [.75, .25]), 2), ch = _c[0], cd = _c[1];\n                d = cd * (h / (ch + cd));\n            }\n            return [h - d, d];\n        };\n        class_1.prototype.remapChars = function (chars) {\n            if (chars.length === 1) {\n                var parent_1 = this.node.coreParent().parent;\n                var isAccent = this.isAccent && !parent_1.isKind('mrow');\n                var map = (isAccent ? 'accent' : 'mo');\n                var text = this.font.getRemappedChar(map, chars[0]);\n                if (text) {\n                    chars = this.unicodeChars(text, this.variant);\n                }\n            }\n            return chars;\n        };\n        return class_1;\n    }(Base));\n}\nexports.CommonMoMixin = CommonMoMixin;\n//# sourceMappingURL=mo.js.map"]},"metadata":{},"sourceType":"script"}