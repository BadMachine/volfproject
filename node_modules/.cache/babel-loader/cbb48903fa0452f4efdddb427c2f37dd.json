{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SVGWrapper = void 0;\n\nvar Wrapper_js_1 = require(\"../common/Wrapper.js\");\n\nvar svg_js_1 = require(\"../svg.js\");\n\nvar SVGWrapper = function (_super) {\n  __extends(SVGWrapper, _super);\n\n  function SVGWrapper() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.element = null;\n    return _this;\n  }\n\n  SVGWrapper.prototype.toSVG = function (parent) {\n    this.addChildren(this.standardSVGnode(parent));\n  };\n\n  SVGWrapper.prototype.addChildren = function (parent) {\n    var e_1, _a;\n\n    var x = 0;\n\n    try {\n      for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var child = _c.value;\n        child.toSVG(parent);\n\n        if (child.element) {\n          child.place(x + child.bbox.L * child.bbox.rscale, 0);\n        }\n\n        x += (child.bbox.L + child.bbox.w + child.bbox.R) * child.bbox.rscale;\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  SVGWrapper.prototype.standardSVGnode = function (parent) {\n    var svg = this.createSVGnode(parent);\n    this.handleStyles();\n    this.handleScale();\n    this.handleColor();\n    this.handleAttributes();\n    return svg;\n  };\n\n  SVGWrapper.prototype.createSVGnode = function (parent) {\n    var href = this.node.attributes.get('href');\n\n    if (href) {\n      parent = this.adaptor.append(parent, this.svg('a', {\n        href: href\n      }));\n\n      var _a = this.getBBox(),\n          h = _a.h,\n          d = _a.d,\n          w = _a.w;\n\n      this.adaptor.append(parent, this.svg('rect', {\n        'data-hitbox': true,\n        fill: 'none',\n        stroke: 'none',\n        'pointer-events': 'all',\n        width: this.fixed(w),\n        height: this.fixed(h + d),\n        y: this.fixed(-d)\n      }));\n    }\n\n    this.element = this.adaptor.append(parent, this.svg('g', {\n      'data-mml-node': this.node.kind\n    }));\n    return this.element;\n  };\n\n  SVGWrapper.prototype.handleStyles = function () {\n    if (!this.styles) return;\n    var styles = this.styles.cssText;\n\n    if (styles) {\n      this.adaptor.setAttribute(this.element, 'style', styles);\n    }\n  };\n\n  SVGWrapper.prototype.handleScale = function () {\n    if (this.bbox.rscale !== 1) {\n      var scale = 'scale(' + this.fixed(this.bbox.rscale / 1000, 3) + ')';\n      this.adaptor.setAttribute(this.element, 'transform', scale);\n    }\n  };\n\n  SVGWrapper.prototype.handleColor = function () {\n    var adaptor = this.adaptor;\n    var attributes = this.node.attributes;\n    var mathcolor = attributes.getExplicit('mathcolor');\n    var color = attributes.getExplicit('color');\n    var mathbackground = attributes.getExplicit('mathbackground');\n    var background = attributes.getExplicit('background');\n\n    if (mathcolor || color) {\n      adaptor.setAttribute(this.element, 'fill', mathcolor || color);\n      adaptor.setAttribute(this.element, 'stroke', mathcolor || color);\n    }\n\n    if (mathbackground || background) {\n      var _a = this.getBBox(),\n          h = _a.h,\n          d = _a.d,\n          w = _a.w;\n\n      var rect = this.svg('rect', {\n        fill: mathbackground || background,\n        x: 0,\n        y: this.fixed(-d),\n        width: this.fixed(w),\n        height: this.fixed(h + d),\n        'data-bgcolor': true\n      });\n      var child = adaptor.firstChild(this.element);\n\n      if (child) {\n        adaptor.insert(rect, child);\n      } else {\n        adaptor.append(this.element, rect);\n      }\n    }\n  };\n\n  SVGWrapper.prototype.handleAttributes = function () {\n    var e_2, _a, e_3, _b;\n\n    var attributes = this.node.attributes;\n    var defaults = attributes.getAllDefaults();\n    var skip = SVGWrapper.skipAttributes;\n\n    try {\n      for (var _c = __values(attributes.getExplicitNames()), _d = _c.next(); !_d.done; _d = _c.next()) {\n        var name_1 = _d.value;\n\n        if (skip[name_1] === false || !(name_1 in defaults) && !skip[name_1] && !this.adaptor.hasAttribute(this.element, name_1)) {\n          this.adaptor.setAttribute(this.element, name_1, attributes.getExplicit(name_1));\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    if (attributes.get('class')) {\n      var names = attributes.get('class').trim().split(/ +/);\n\n      try {\n        for (var names_1 = __values(names), names_1_1 = names_1.next(); !names_1_1.done; names_1_1 = names_1.next()) {\n          var name_2 = names_1_1.value;\n          this.adaptor.addClass(this.element, name_2);\n        }\n      } catch (e_3_1) {\n        e_3 = {\n          error: e_3_1\n        };\n      } finally {\n        try {\n          if (names_1_1 && !names_1_1.done && (_b = names_1.return)) _b.call(names_1);\n        } finally {\n          if (e_3) throw e_3.error;\n        }\n      }\n    }\n  };\n\n  SVGWrapper.prototype.place = function (x, y, element) {\n    if (element === void 0) {\n      element = null;\n    }\n\n    if (!(x || y)) return;\n\n    if (!element) {\n      element = this.element;\n    }\n\n    var transform = this.adaptor.getAttribute(element, 'transform') || '';\n    transform = 'translate(' + this.fixed(x) + ', ' + this.fixed(y) + ')' + (transform ? ' ' + transform : '');\n    this.adaptor.setAttribute(element, 'transform', transform);\n  };\n\n  SVGWrapper.prototype.placeChar = function (n, x, y, parent, variant) {\n    var e_4, _a;\n\n    if (variant === void 0) {\n      variant = null;\n    }\n\n    if (variant === null) {\n      variant = this.variant;\n    }\n\n    var C = n.toString(16).toUpperCase();\n\n    var _b = __read(this.getVariantChar(variant, n), 4),\n        w = _b[2],\n        data = _b[3];\n\n    if ('p' in data) {\n      var path = data.p ? 'M' + data.p + 'Z' : '';\n      this.place(x, y, this.adaptor.append(parent, this.charNode(variant, C, path)));\n    } else if ('c' in data) {\n      var g = this.adaptor.append(parent, this.svg('g', {\n        'data-c': C\n      }));\n      this.place(x, y, g);\n      x = 0;\n\n      try {\n        for (var _c = __values(this.unicodeChars(data.c, variant)), _d = _c.next(); !_d.done; _d = _c.next()) {\n          var n_1 = _d.value;\n          x += this.placeChar(n_1, x, y, g, variant);\n        }\n      } catch (e_4_1) {\n        e_4 = {\n          error: e_4_1\n        };\n      } finally {\n        try {\n          if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n        } finally {\n          if (e_4) throw e_4.error;\n        }\n      }\n    } else if (data.unknown) {\n      var char = String.fromCodePoint(n);\n      var text = this.adaptor.append(parent, this.jax.unknownText(char, variant));\n      this.place(x, y, text);\n      return this.jax.measureTextNodeWithCache(text, char, variant).w;\n    }\n\n    return w;\n  };\n\n  SVGWrapper.prototype.charNode = function (variant, C, path) {\n    var cache = this.jax.options.fontCache;\n    return cache !== 'none' ? this.useNode(variant, C, path) : this.pathNode(C, path);\n  };\n\n  SVGWrapper.prototype.pathNode = function (C, path) {\n    return this.svg('path', {\n      'data-c': C,\n      d: path\n    });\n  };\n\n  SVGWrapper.prototype.useNode = function (variant, C, path) {\n    var use = this.svg('use');\n    var id = '#' + this.jax.fontCache.cachePath(variant, C, path);\n    this.adaptor.setAttribute(use, 'href', id, svg_js_1.XLINKNS);\n    return use;\n  };\n\n  SVGWrapper.prototype.drawBBox = function () {\n    var _a = this.getBBox(),\n        w = _a.w,\n        h = _a.h,\n        d = _a.d;\n\n    var box = this.svg('g', {\n      style: {\n        opacity: .25\n      }\n    }, [this.svg('rect', {\n      fill: 'red',\n      height: this.fixed(h),\n      width: this.fixed(w)\n    }), this.svg('rect', {\n      fill: 'green',\n      height: this.fixed(d),\n      width: this.fixed(w),\n      y: this.fixed(-d)\n    })]);\n    var node = this.element || this.parent.element;\n    this.adaptor.append(node, box);\n  };\n\n  SVGWrapper.prototype.html = function (type, def, content) {\n    if (def === void 0) {\n      def = {};\n    }\n\n    if (content === void 0) {\n      content = [];\n    }\n\n    return this.jax.html(type, def, content);\n  };\n\n  SVGWrapper.prototype.svg = function (type, def, content) {\n    if (def === void 0) {\n      def = {};\n    }\n\n    if (content === void 0) {\n      content = [];\n    }\n\n    return this.jax.svg(type, def, content);\n  };\n\n  SVGWrapper.prototype.text = function (text) {\n    return this.jax.text(text);\n  };\n\n  SVGWrapper.prototype.fixed = function (x, n) {\n    if (n === void 0) {\n      n = 1;\n    }\n\n    return this.jax.fixed(x * 1000, n);\n  };\n\n  SVGWrapper.kind = 'unknown';\n  return SVGWrapper;\n}(Wrapper_js_1.CommonWrapper);\n\nexports.SVGWrapper = SVGWrapper;","map":{"version":3,"sources":["../../../ts/output/svg/Wrapper.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SVGWrapper = void 0;\nvar Wrapper_js_1 = require(\"../common/Wrapper.js\");\nvar svg_js_1 = require(\"../svg.js\");\nvar SVGWrapper = (function (_super) {\n    __extends(SVGWrapper, _super);\n    function SVGWrapper() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.element = null;\n        return _this;\n    }\n    SVGWrapper.prototype.toSVG = function (parent) {\n        this.addChildren(this.standardSVGnode(parent));\n    };\n    SVGWrapper.prototype.addChildren = function (parent) {\n        var e_1, _a;\n        var x = 0;\n        try {\n            for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var child = _c.value;\n                child.toSVG(parent);\n                if (child.element) {\n                    child.place(x + child.bbox.L * child.bbox.rscale, 0);\n                }\n                x += (child.bbox.L + child.bbox.w + child.bbox.R) * child.bbox.rscale;\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    };\n    SVGWrapper.prototype.standardSVGnode = function (parent) {\n        var svg = this.createSVGnode(parent);\n        this.handleStyles();\n        this.handleScale();\n        this.handleColor();\n        this.handleAttributes();\n        return svg;\n    };\n    SVGWrapper.prototype.createSVGnode = function (parent) {\n        var href = this.node.attributes.get('href');\n        if (href) {\n            parent = this.adaptor.append(parent, this.svg('a', { href: href }));\n            var _a = this.getBBox(), h = _a.h, d = _a.d, w = _a.w;\n            this.adaptor.append(parent, this.svg('rect', {\n                'data-hitbox': true, fill: 'none', stroke: 'none', 'pointer-events': 'all',\n                width: this.fixed(w), height: this.fixed(h + d), y: this.fixed(-d)\n            }));\n        }\n        this.element = this.adaptor.append(parent, this.svg('g', { 'data-mml-node': this.node.kind }));\n        return this.element;\n    };\n    SVGWrapper.prototype.handleStyles = function () {\n        if (!this.styles)\n            return;\n        var styles = this.styles.cssText;\n        if (styles) {\n            this.adaptor.setAttribute(this.element, 'style', styles);\n        }\n    };\n    SVGWrapper.prototype.handleScale = function () {\n        if (this.bbox.rscale !== 1) {\n            var scale = 'scale(' + this.fixed(this.bbox.rscale / 1000, 3) + ')';\n            this.adaptor.setAttribute(this.element, 'transform', scale);\n        }\n    };\n    SVGWrapper.prototype.handleColor = function () {\n        var adaptor = this.adaptor;\n        var attributes = this.node.attributes;\n        var mathcolor = attributes.getExplicit('mathcolor');\n        var color = attributes.getExplicit('color');\n        var mathbackground = attributes.getExplicit('mathbackground');\n        var background = attributes.getExplicit('background');\n        if (mathcolor || color) {\n            adaptor.setAttribute(this.element, 'fill', mathcolor || color);\n            adaptor.setAttribute(this.element, 'stroke', mathcolor || color);\n        }\n        if (mathbackground || background) {\n            var _a = this.getBBox(), h = _a.h, d = _a.d, w = _a.w;\n            var rect = this.svg('rect', {\n                fill: mathbackground || background,\n                x: 0, y: this.fixed(-d),\n                width: this.fixed(w),\n                height: this.fixed(h + d),\n                'data-bgcolor': true\n            });\n            var child = adaptor.firstChild(this.element);\n            if (child) {\n                adaptor.insert(rect, child);\n            }\n            else {\n                adaptor.append(this.element, rect);\n            }\n        }\n    };\n    SVGWrapper.prototype.handleAttributes = function () {\n        var e_2, _a, e_3, _b;\n        var attributes = this.node.attributes;\n        var defaults = attributes.getAllDefaults();\n        var skip = SVGWrapper.skipAttributes;\n        try {\n            for (var _c = __values(attributes.getExplicitNames()), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var name_1 = _d.value;\n                if (skip[name_1] === false || (!(name_1 in defaults) && !skip[name_1] &&\n                    !this.adaptor.hasAttribute(this.element, name_1))) {\n                    this.adaptor.setAttribute(this.element, name_1, attributes.getExplicit(name_1));\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        if (attributes.get('class')) {\n            var names = attributes.get('class').trim().split(/ +/);\n            try {\n                for (var names_1 = __values(names), names_1_1 = names_1.next(); !names_1_1.done; names_1_1 = names_1.next()) {\n                    var name_2 = names_1_1.value;\n                    this.adaptor.addClass(this.element, name_2);\n                }\n            }\n            catch (e_3_1) { e_3 = { error: e_3_1 }; }\n            finally {\n                try {\n                    if (names_1_1 && !names_1_1.done && (_b = names_1.return)) _b.call(names_1);\n                }\n                finally { if (e_3) throw e_3.error; }\n            }\n        }\n    };\n    SVGWrapper.prototype.place = function (x, y, element) {\n        if (element === void 0) { element = null; }\n        if (!(x || y))\n            return;\n        if (!element) {\n            element = this.element;\n        }\n        var transform = this.adaptor.getAttribute(element, 'transform') || '';\n        transform = 'translate(' + this.fixed(x) + ', ' + this.fixed(y) + ')' + (transform ? ' ' + transform : '');\n        this.adaptor.setAttribute(element, 'transform', transform);\n    };\n    SVGWrapper.prototype.placeChar = function (n, x, y, parent, variant) {\n        var e_4, _a;\n        if (variant === void 0) { variant = null; }\n        if (variant === null) {\n            variant = this.variant;\n        }\n        var C = n.toString(16).toUpperCase();\n        var _b = __read(this.getVariantChar(variant, n), 4), w = _b[2], data = _b[3];\n        if ('p' in data) {\n            var path = (data.p ? 'M' + data.p + 'Z' : '');\n            this.place(x, y, this.adaptor.append(parent, this.charNode(variant, C, path)));\n        }\n        else if ('c' in data) {\n            var g = this.adaptor.append(parent, this.svg('g', { 'data-c': C }));\n            this.place(x, y, g);\n            x = 0;\n            try {\n                for (var _c = __values(this.unicodeChars(data.c, variant)), _d = _c.next(); !_d.done; _d = _c.next()) {\n                    var n_1 = _d.value;\n                    x += this.placeChar(n_1, x, y, g, variant);\n                }\n            }\n            catch (e_4_1) { e_4 = { error: e_4_1 }; }\n            finally {\n                try {\n                    if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n                }\n                finally { if (e_4) throw e_4.error; }\n            }\n        }\n        else if (data.unknown) {\n            var char = String.fromCodePoint(n);\n            var text = this.adaptor.append(parent, this.jax.unknownText(char, variant));\n            this.place(x, y, text);\n            return this.jax.measureTextNodeWithCache(text, char, variant).w;\n        }\n        return w;\n    };\n    SVGWrapper.prototype.charNode = function (variant, C, path) {\n        var cache = this.jax.options.fontCache;\n        return (cache !== 'none' ? this.useNode(variant, C, path) : this.pathNode(C, path));\n    };\n    SVGWrapper.prototype.pathNode = function (C, path) {\n        return this.svg('path', { 'data-c': C, d: path });\n    };\n    SVGWrapper.prototype.useNode = function (variant, C, path) {\n        var use = this.svg('use');\n        var id = '#' + this.jax.fontCache.cachePath(variant, C, path);\n        this.adaptor.setAttribute(use, 'href', id, svg_js_1.XLINKNS);\n        return use;\n    };\n    SVGWrapper.prototype.drawBBox = function () {\n        var _a = this.getBBox(), w = _a.w, h = _a.h, d = _a.d;\n        var box = this.svg('g', { style: {\n                opacity: .25\n            } }, [\n            this.svg('rect', {\n                fill: 'red',\n                height: this.fixed(h),\n                width: this.fixed(w)\n            }),\n            this.svg('rect', {\n                fill: 'green',\n                height: this.fixed(d),\n                width: this.fixed(w),\n                y: this.fixed(-d)\n            })\n        ]);\n        var node = this.element || this.parent.element;\n        this.adaptor.append(node, box);\n    };\n    SVGWrapper.prototype.html = function (type, def, content) {\n        if (def === void 0) { def = {}; }\n        if (content === void 0) { content = []; }\n        return this.jax.html(type, def, content);\n    };\n    SVGWrapper.prototype.svg = function (type, def, content) {\n        if (def === void 0) { def = {}; }\n        if (content === void 0) { content = []; }\n        return this.jax.svg(type, def, content);\n    };\n    SVGWrapper.prototype.text = function (text) {\n        return this.jax.text(text);\n    };\n    SVGWrapper.prototype.fixed = function (x, n) {\n        if (n === void 0) { n = 1; }\n        return this.jax.fixed(x * 1000, n);\n    };\n    SVGWrapper.kind = 'unknown';\n    return SVGWrapper;\n}(Wrapper_js_1.CommonWrapper));\nexports.SVGWrapper = SVGWrapper;\n//# sourceMappingURL=Wrapper.js.map"]},"metadata":{},"sourceType":"script"}