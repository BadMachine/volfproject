{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MmlMo = void 0;\n\nvar MmlNode_js_1 = require(\"../MmlNode.js\");\n\nvar OperatorDictionary_js_1 = require(\"../OperatorDictionary.js\");\n\nvar MmlMo = function (_super) {\n  __extends(MmlMo, _super);\n\n  function MmlMo() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this._texClass = null;\n    _this.lspace = 5 / 18;\n    _this.rspace = 5 / 18;\n    return _this;\n  }\n\n  Object.defineProperty(MmlMo.prototype, \"texClass\", {\n    get: function () {\n      if (this._texClass === null) {\n        var mo = this.getText();\n\n        var _a = __read(this.handleExplicitForm(this.getForms()), 3),\n            form1 = _a[0],\n            form2 = _a[1],\n            form3 = _a[2];\n\n        var OPTABLE_1 = this.constructor.OPTABLE;\n        var def = OPTABLE_1[form1][mo] || OPTABLE_1[form2][mo] || OPTABLE_1[form3][mo];\n        return def ? def[2] : MmlNode_js_1.TEXCLASS.REL;\n      }\n\n      return this._texClass;\n    },\n    set: function (value) {\n      this._texClass = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(MmlMo.prototype, \"kind\", {\n    get: function () {\n      return 'mo';\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(MmlMo.prototype, \"isEmbellished\", {\n    get: function () {\n      return true;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(MmlMo.prototype, \"hasNewLine\", {\n    get: function () {\n      return this.attributes.get('linebreak') === 'newline';\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  MmlMo.prototype.coreParent = function () {\n    var embellished = this;\n    var parent = this;\n    var math = this.factory.getNodeClass('math');\n\n    while (parent && parent.isEmbellished && parent.coreMO() === this && !(parent instanceof math)) {\n      embellished = parent;\n      parent = parent.Parent;\n    }\n\n    return embellished;\n  };\n\n  MmlMo.prototype.coreText = function (parent) {\n    if (!parent) {\n      return '';\n    }\n\n    if (parent.isEmbellished) {\n      return parent.coreMO().getText();\n    }\n\n    while (((parent.isKind('mrow') || parent.isKind('TeXAtom') || parent.isKind('mstyle') || parent.isKind('mphantom')) && parent.childNodes.length === 1 || parent.isKind('munderover')) && parent.childNodes[0]) {\n      parent = parent.childNodes[0];\n    }\n\n    return parent.isToken ? parent.getText() : '';\n  };\n\n  MmlMo.prototype.hasSpacingAttributes = function () {\n    return this.attributes.isSet('lspace') || this.attributes.isSet('rspace');\n  };\n\n  Object.defineProperty(MmlMo.prototype, \"isAccent\", {\n    get: function () {\n      var accent = false;\n      var node = this.coreParent().parent;\n\n      if (node) {\n        var key = node.isKind('mover') ? node.childNodes[node.over].coreMO() ? 'accent' : '' : node.isKind('munder') ? node.childNodes[node.under].coreMO() ? 'accentunder' : '' : node.isKind('munderover') ? this === node.childNodes[node.over].coreMO() ? 'accent' : this === node.childNodes[node.under].coreMO() ? 'accentunder' : '' : '';\n\n        if (key) {\n          var value = node.attributes.getExplicit(key);\n          accent = value !== undefined ? accent : this.attributes.get('accent');\n        }\n      }\n\n      return accent;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  MmlMo.prototype.setTeXclass = function (prev) {\n    var _a = this.attributes.getList('form', 'fence'),\n        form = _a.form,\n        fence = _a.fence;\n\n    if (this.getProperty('texClass') === undefined && (this.attributes.isSet('lspace') || this.attributes.isSet('rspace'))) {\n      return null;\n    }\n\n    if (fence && this.texClass === MmlNode_js_1.TEXCLASS.REL) {\n      if (form === 'prefix') {\n        this.texClass = MmlNode_js_1.TEXCLASS.OPEN;\n      }\n\n      if (form === 'postfix') {\n        this.texClass = MmlNode_js_1.TEXCLASS.CLOSE;\n      }\n    }\n\n    if (this.getText() === '\\u2061') {\n      if (prev) {\n        prev.texClass = MmlNode_js_1.TEXCLASS.OP;\n        prev.setProperty('fnOP', true);\n      }\n\n      this.texClass = this.prevClass = MmlNode_js_1.TEXCLASS.NONE;\n      return prev;\n    }\n\n    return this.adjustTeXclass(prev);\n  };\n\n  MmlMo.prototype.adjustTeXclass = function (prev) {\n    var texClass = this.texClass;\n    var prevClass = this.prevClass;\n\n    if (texClass === MmlNode_js_1.TEXCLASS.NONE) {\n      return prev;\n    }\n\n    if (prev) {\n      if (prev.getProperty('autoOP') && (texClass === MmlNode_js_1.TEXCLASS.BIN || texClass === MmlNode_js_1.TEXCLASS.REL)) {\n        prevClass = prev.texClass = MmlNode_js_1.TEXCLASS.ORD;\n      }\n\n      prevClass = this.prevClass = prev.texClass || MmlNode_js_1.TEXCLASS.ORD;\n      this.prevLevel = this.attributes.getInherited('scriptlevel');\n    } else {\n      prevClass = this.prevClass = MmlNode_js_1.TEXCLASS.NONE;\n    }\n\n    if (texClass === MmlNode_js_1.TEXCLASS.BIN && (prevClass === MmlNode_js_1.TEXCLASS.NONE || prevClass === MmlNode_js_1.TEXCLASS.BIN || prevClass === MmlNode_js_1.TEXCLASS.OP || prevClass === MmlNode_js_1.TEXCLASS.REL || prevClass === MmlNode_js_1.TEXCLASS.OPEN || prevClass === MmlNode_js_1.TEXCLASS.PUNCT)) {\n      this.texClass = MmlNode_js_1.TEXCLASS.ORD;\n    } else if (prevClass === MmlNode_js_1.TEXCLASS.BIN && (texClass === MmlNode_js_1.TEXCLASS.REL || texClass === MmlNode_js_1.TEXCLASS.CLOSE || texClass === MmlNode_js_1.TEXCLASS.PUNCT)) {\n      prev.texClass = this.prevClass = MmlNode_js_1.TEXCLASS.ORD;\n    } else if (texClass === MmlNode_js_1.TEXCLASS.BIN) {\n      var child = this;\n      var parent_1 = this.parent;\n\n      while (parent_1 && parent_1.parent && parent_1.isEmbellished && (parent_1.childNodes.length === 1 || !parent_1.isKind('mrow') && parent_1.core() === child)) {\n        child = parent_1;\n        parent_1 = parent_1.parent;\n      }\n\n      if (parent_1.childNodes[parent_1.childNodes.length - 1] === child) {\n        this.texClass = MmlNode_js_1.TEXCLASS.ORD;\n      }\n    }\n\n    return this;\n  };\n\n  MmlMo.prototype.setInheritedAttributes = function (attributes, display, level, prime) {\n    var e_1, _a;\n\n    if (attributes === void 0) {\n      attributes = {};\n    }\n\n    if (display === void 0) {\n      display = false;\n    }\n\n    if (level === void 0) {\n      level = 0;\n    }\n\n    if (prime === void 0) {\n      prime = false;\n    }\n\n    _super.prototype.setInheritedAttributes.call(this, attributes, display, level, prime);\n\n    var mo = this.getText();\n\n    var _b = __read(this.handleExplicitForm(this.getForms()), 3),\n        form1 = _b[0],\n        form2 = _b[1],\n        form3 = _b[2];\n\n    this.attributes.setInherited('form', form1);\n    var OPTABLE = this.constructor.OPTABLE;\n    var def = OPTABLE[form1][mo] || OPTABLE[form2][mo] || OPTABLE[form3][mo];\n\n    if (def) {\n      if (this.getProperty('texClass') === undefined) {\n        this.texClass = def[2];\n      }\n\n      try {\n        for (var _c = __values(Object.keys(def[3] || {})), _d = _c.next(); !_d.done; _d = _c.next()) {\n          var name_1 = _d.value;\n          this.attributes.setInherited(name_1, def[3][name_1]);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n\n      this.lspace = (def[0] + 1) / 18;\n      this.rspace = (def[1] + 1) / 18;\n    } else {\n      var range = this.getRange(mo);\n\n      if (range) {\n        if (this.getProperty('texClass') === undefined) {\n          this.texClass = range[2];\n        }\n\n        var spacing = this.constructor.MMLSPACING[range[2]];\n        this.lspace = (spacing[0] + 1) / 18;\n        this.rspace = (spacing[1] + 1) / 18;\n      }\n    }\n  };\n\n  MmlMo.prototype.getForms = function () {\n    var core = this;\n    var parent = this.parent;\n    var Parent = this.Parent;\n\n    while (Parent && Parent.isEmbellished) {\n      core = parent;\n      parent = Parent.parent;\n      Parent = Parent.Parent;\n    }\n\n    if (parent && parent.isKind('mrow') && parent.nonSpaceLength() !== 1) {\n      if (parent.firstNonSpace() === core) {\n        return ['prefix', 'infix', 'postfix'];\n      }\n\n      if (parent.lastNonSpace() === core) {\n        return ['postfix', 'infix', 'prefix'];\n      }\n    }\n\n    return ['infix', 'prefix', 'postfix'];\n  };\n\n  MmlMo.prototype.handleExplicitForm = function (forms) {\n    if (this.attributes.isSet('form')) {\n      var form_1 = this.attributes.get('form');\n      forms = [form_1].concat(forms.filter(function (name) {\n        return name !== form_1;\n      }));\n    }\n\n    return forms;\n  };\n\n  MmlMo.prototype.getRange = function (mo) {\n    var e_2, _a;\n\n    if (!mo.match(/^[\\uD800-\\uDBFF]?.$/)) {\n      return null;\n    }\n\n    var n = mo.codePointAt(0);\n    var ranges = this.constructor.RANGES;\n\n    try {\n      for (var ranges_1 = __values(ranges), ranges_1_1 = ranges_1.next(); !ranges_1_1.done; ranges_1_1 = ranges_1.next()) {\n        var range = ranges_1_1.value;\n\n        if (range[0] <= n && n <= range[1]) {\n          return range;\n        }\n\n        if (n < range[0]) {\n          return null;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (ranges_1_1 && !ranges_1_1.done && (_a = ranges_1.return)) _a.call(ranges_1);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return null;\n  };\n\n  MmlMo.defaults = __assign(__assign({}, MmlNode_js_1.AbstractMmlTokenNode.defaults), {\n    form: 'infix',\n    fence: false,\n    separator: false,\n    lspace: 'thickmathspace',\n    rspace: 'thickmathspace',\n    stretchy: false,\n    symmetric: false,\n    maxsize: 'infinity',\n    minsize: '0em',\n    largeop: false,\n    movablelimits: false,\n    accent: false,\n    linebreak: 'auto',\n    lineleading: '1ex',\n    linebreakstyle: 'before',\n    indentalign: 'auto',\n    indentshift: '0',\n    indenttarget: '',\n    indentalignfirst: 'indentalign',\n    indentshiftfirst: 'indentshift',\n    indentalignlast: 'indentalign',\n    indentshiftlast: 'indentshift'\n  });\n  MmlMo.RANGES = OperatorDictionary_js_1.RANGES;\n  MmlMo.MMLSPACING = OperatorDictionary_js_1.MMLSPACING;\n  MmlMo.OPTABLE = OperatorDictionary_js_1.OPTABLE;\n  return MmlMo;\n}(MmlNode_js_1.AbstractMmlTokenNode);\n\nexports.MmlMo = MmlMo;","map":{"version":3,"sources":["../../../../ts/core/MmlTree/MmlNodes/mo.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MmlMo = void 0;\nvar MmlNode_js_1 = require(\"../MmlNode.js\");\nvar OperatorDictionary_js_1 = require(\"../OperatorDictionary.js\");\nvar MmlMo = (function (_super) {\n    __extends(MmlMo, _super);\n    function MmlMo() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._texClass = null;\n        _this.lspace = 5 / 18;\n        _this.rspace = 5 / 18;\n        return _this;\n    }\n    Object.defineProperty(MmlMo.prototype, \"texClass\", {\n        get: function () {\n            if (this._texClass === null) {\n                var mo = this.getText();\n                var _a = __read(this.handleExplicitForm(this.getForms()), 3), form1 = _a[0], form2 = _a[1], form3 = _a[2];\n                var OPTABLE_1 = this.constructor.OPTABLE;\n                var def = OPTABLE_1[form1][mo] || OPTABLE_1[form2][mo] || OPTABLE_1[form3][mo];\n                return def ? def[2] : MmlNode_js_1.TEXCLASS.REL;\n            }\n            return this._texClass;\n        },\n        set: function (value) {\n            this._texClass = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MmlMo.prototype, \"kind\", {\n        get: function () {\n            return 'mo';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MmlMo.prototype, \"isEmbellished\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MmlMo.prototype, \"hasNewLine\", {\n        get: function () {\n            return this.attributes.get('linebreak') === 'newline';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    MmlMo.prototype.coreParent = function () {\n        var embellished = this;\n        var parent = this;\n        var math = this.factory.getNodeClass('math');\n        while (parent && parent.isEmbellished && parent.coreMO() === this && !(parent instanceof math)) {\n            embellished = parent;\n            parent = parent.Parent;\n        }\n        return embellished;\n    };\n    MmlMo.prototype.coreText = function (parent) {\n        if (!parent) {\n            return '';\n        }\n        if (parent.isEmbellished) {\n            return parent.coreMO().getText();\n        }\n        while ((((parent.isKind('mrow') || parent.isKind('TeXAtom') || parent.isKind('mstyle') ||\n            parent.isKind('mphantom')) && parent.childNodes.length === 1) ||\n            parent.isKind('munderover')) && parent.childNodes[0]) {\n            parent = parent.childNodes[0];\n        }\n        return (parent.isToken ? parent.getText() : '');\n    };\n    MmlMo.prototype.hasSpacingAttributes = function () {\n        return this.attributes.isSet('lspace') ||\n            this.attributes.isSet('rspace');\n    };\n    Object.defineProperty(MmlMo.prototype, \"isAccent\", {\n        get: function () {\n            var accent = false;\n            var node = this.coreParent().parent;\n            if (node) {\n                var key = (node.isKind('mover') ?\n                    (node.childNodes[node.over].coreMO() ?\n                        'accent' : '') :\n                    node.isKind('munder') ?\n                        (node.childNodes[node.under].coreMO() ?\n                            'accentunder' : '') :\n                        node.isKind('munderover') ?\n                            (this === node.childNodes[node.over].coreMO() ?\n                                'accent' :\n                                this === node.childNodes[node.under].coreMO() ?\n                                    'accentunder' : '') :\n                            '');\n                if (key) {\n                    var value = node.attributes.getExplicit(key);\n                    accent = (value !== undefined ? accent : this.attributes.get('accent'));\n                }\n            }\n            return accent;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    MmlMo.prototype.setTeXclass = function (prev) {\n        var _a = this.attributes.getList('form', 'fence'), form = _a.form, fence = _a.fence;\n        if (this.getProperty('texClass') === undefined &&\n            (this.attributes.isSet('lspace') || this.attributes.isSet('rspace'))) {\n            return null;\n        }\n        if (fence && this.texClass === MmlNode_js_1.TEXCLASS.REL) {\n            if (form === 'prefix') {\n                this.texClass = MmlNode_js_1.TEXCLASS.OPEN;\n            }\n            if (form === 'postfix') {\n                this.texClass = MmlNode_js_1.TEXCLASS.CLOSE;\n            }\n        }\n        if (this.getText() === '\\u2061') {\n            if (prev) {\n                prev.texClass = MmlNode_js_1.TEXCLASS.OP;\n                prev.setProperty('fnOP', true);\n            }\n            this.texClass = this.prevClass = MmlNode_js_1.TEXCLASS.NONE;\n            return prev;\n        }\n        return this.adjustTeXclass(prev);\n    };\n    MmlMo.prototype.adjustTeXclass = function (prev) {\n        var texClass = this.texClass;\n        var prevClass = this.prevClass;\n        if (texClass === MmlNode_js_1.TEXCLASS.NONE) {\n            return prev;\n        }\n        if (prev) {\n            if (prev.getProperty('autoOP') && (texClass === MmlNode_js_1.TEXCLASS.BIN || texClass === MmlNode_js_1.TEXCLASS.REL)) {\n                prevClass = prev.texClass = MmlNode_js_1.TEXCLASS.ORD;\n            }\n            prevClass = this.prevClass = (prev.texClass || MmlNode_js_1.TEXCLASS.ORD);\n            this.prevLevel = this.attributes.getInherited('scriptlevel');\n        }\n        else {\n            prevClass = this.prevClass = MmlNode_js_1.TEXCLASS.NONE;\n        }\n        if (texClass === MmlNode_js_1.TEXCLASS.BIN &&\n            (prevClass === MmlNode_js_1.TEXCLASS.NONE || prevClass === MmlNode_js_1.TEXCLASS.BIN || prevClass === MmlNode_js_1.TEXCLASS.OP ||\n                prevClass === MmlNode_js_1.TEXCLASS.REL || prevClass === MmlNode_js_1.TEXCLASS.OPEN || prevClass === MmlNode_js_1.TEXCLASS.PUNCT)) {\n            this.texClass = MmlNode_js_1.TEXCLASS.ORD;\n        }\n        else if (prevClass === MmlNode_js_1.TEXCLASS.BIN &&\n            (texClass === MmlNode_js_1.TEXCLASS.REL || texClass === MmlNode_js_1.TEXCLASS.CLOSE || texClass === MmlNode_js_1.TEXCLASS.PUNCT)) {\n            prev.texClass = this.prevClass = MmlNode_js_1.TEXCLASS.ORD;\n        }\n        else if (texClass === MmlNode_js_1.TEXCLASS.BIN) {\n            var child = this;\n            var parent_1 = this.parent;\n            while (parent_1 && parent_1.parent && parent_1.isEmbellished &&\n                (parent_1.childNodes.length === 1 ||\n                    (!parent_1.isKind('mrow') && parent_1.core() === child))) {\n                child = parent_1;\n                parent_1 = parent_1.parent;\n            }\n            if (parent_1.childNodes[parent_1.childNodes.length - 1] === child) {\n                this.texClass = MmlNode_js_1.TEXCLASS.ORD;\n            }\n        }\n        return this;\n    };\n    MmlMo.prototype.setInheritedAttributes = function (attributes, display, level, prime) {\n        var e_1, _a;\n        if (attributes === void 0) { attributes = {}; }\n        if (display === void 0) { display = false; }\n        if (level === void 0) { level = 0; }\n        if (prime === void 0) { prime = false; }\n        _super.prototype.setInheritedAttributes.call(this, attributes, display, level, prime);\n        var mo = this.getText();\n        var _b = __read(this.handleExplicitForm(this.getForms()), 3), form1 = _b[0], form2 = _b[1], form3 = _b[2];\n        this.attributes.setInherited('form', form1);\n        var OPTABLE = this.constructor.OPTABLE;\n        var def = OPTABLE[form1][mo] || OPTABLE[form2][mo] || OPTABLE[form3][mo];\n        if (def) {\n            if (this.getProperty('texClass') === undefined) {\n                this.texClass = def[2];\n            }\n            try {\n                for (var _c = __values(Object.keys(def[3] || {})), _d = _c.next(); !_d.done; _d = _c.next()) {\n                    var name_1 = _d.value;\n                    this.attributes.setInherited(name_1, def[3][name_1]);\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n            this.lspace = (def[0] + 1) / 18;\n            this.rspace = (def[1] + 1) / 18;\n        }\n        else {\n            var range = this.getRange(mo);\n            if (range) {\n                if (this.getProperty('texClass') === undefined) {\n                    this.texClass = range[2];\n                }\n                var spacing = this.constructor.MMLSPACING[range[2]];\n                this.lspace = (spacing[0] + 1) / 18;\n                this.rspace = (spacing[1] + 1) / 18;\n            }\n        }\n    };\n    MmlMo.prototype.getForms = function () {\n        var core = this;\n        var parent = this.parent;\n        var Parent = this.Parent;\n        while (Parent && Parent.isEmbellished) {\n            core = parent;\n            parent = Parent.parent;\n            Parent = Parent.Parent;\n        }\n        if (parent && parent.isKind('mrow') && parent.nonSpaceLength() !== 1) {\n            if (parent.firstNonSpace() === core) {\n                return ['prefix', 'infix', 'postfix'];\n            }\n            if (parent.lastNonSpace() === core) {\n                return ['postfix', 'infix', 'prefix'];\n            }\n        }\n        return ['infix', 'prefix', 'postfix'];\n    };\n    MmlMo.prototype.handleExplicitForm = function (forms) {\n        if (this.attributes.isSet('form')) {\n            var form_1 = this.attributes.get('form');\n            forms = [form_1].concat(forms.filter(function (name) { return (name !== form_1); }));\n        }\n        return forms;\n    };\n    MmlMo.prototype.getRange = function (mo) {\n        var e_2, _a;\n        if (!mo.match(/^[\\uD800-\\uDBFF]?.$/)) {\n            return null;\n        }\n        var n = mo.codePointAt(0);\n        var ranges = this.constructor.RANGES;\n        try {\n            for (var ranges_1 = __values(ranges), ranges_1_1 = ranges_1.next(); !ranges_1_1.done; ranges_1_1 = ranges_1.next()) {\n                var range = ranges_1_1.value;\n                if (range[0] <= n && n <= range[1]) {\n                    return range;\n                }\n                if (n < range[0]) {\n                    return null;\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (ranges_1_1 && !ranges_1_1.done && (_a = ranges_1.return)) _a.call(ranges_1);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return null;\n    };\n    MmlMo.defaults = __assign(__assign({}, MmlNode_js_1.AbstractMmlTokenNode.defaults), { form: 'infix', fence: false, separator: false, lspace: 'thickmathspace', rspace: 'thickmathspace', stretchy: false, symmetric: false, maxsize: 'infinity', minsize: '0em', largeop: false, movablelimits: false, accent: false, linebreak: 'auto', lineleading: '1ex', linebreakstyle: 'before', indentalign: 'auto', indentshift: '0', indenttarget: '', indentalignfirst: 'indentalign', indentshiftfirst: 'indentshift', indentalignlast: 'indentalign', indentshiftlast: 'indentshift' });\n    MmlMo.RANGES = OperatorDictionary_js_1.RANGES;\n    MmlMo.MMLSPACING = OperatorDictionary_js_1.MMLSPACING;\n    MmlMo.OPTABLE = OperatorDictionary_js_1.OPTABLE;\n    return MmlMo;\n}(MmlNode_js_1.AbstractMmlTokenNode));\nexports.MmlMo = MmlMo;\n//# sourceMappingURL=mo.js.map"]},"metadata":{},"sourceType":"script"}