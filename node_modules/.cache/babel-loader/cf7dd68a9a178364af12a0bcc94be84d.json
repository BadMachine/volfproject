{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommonWrapper = void 0;\n\nvar Wrapper_js_1 = require(\"../../core/Tree/Wrapper.js\");\n\nvar MmlNode_js_1 = require(\"../../core/MmlTree/MmlNode.js\");\n\nvar string_js_1 = require(\"../../util/string.js\");\n\nvar LENGTHS = require(\"../../util/lengths.js\");\n\nvar Styles_js_1 = require(\"../../util/Styles.js\");\n\nvar BBox_js_1 = require(\"../../util/BBox.js\");\n\nvar FontData_js_1 = require(\"./FontData.js\");\n\nvar SMALLSIZE = 2 / 18;\n\nfunction MathMLSpace(script, size) {\n  return script ? size < SMALLSIZE ? 0 : SMALLSIZE : size;\n}\n\nvar CommonWrapper = function (_super) {\n  __extends(CommonWrapper, _super);\n\n  function CommonWrapper(factory, node, parent) {\n    if (parent === void 0) {\n      parent = null;\n    }\n\n    var _this = _super.call(this, factory, node) || this;\n\n    _this.parent = null;\n    _this.removedStyles = null;\n    _this.styles = null;\n    _this.variant = '';\n    _this.bboxComputed = false;\n    _this.stretch = FontData_js_1.NOSTRETCH;\n    _this.font = null;\n    _this.parent = parent;\n    _this.font = factory.jax.font;\n    _this.bbox = BBox_js_1.BBox.zero();\n\n    _this.getStyles();\n\n    _this.getVariant();\n\n    _this.getScale();\n\n    _this.getSpace();\n\n    _this.childNodes = node.childNodes.map(function (child) {\n      var wrapped = _this.wrap(child);\n\n      if (wrapped.bbox.pwidth && (node.notParent || node.isKind('math'))) {\n        _this.bbox.pwidth = BBox_js_1.BBox.fullWidth;\n      }\n\n      return wrapped;\n    });\n    return _this;\n  }\n\n  Object.defineProperty(CommonWrapper.prototype, \"jax\", {\n    get: function () {\n      return this.factory.jax;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(CommonWrapper.prototype, \"adaptor\", {\n    get: function () {\n      return this.factory.jax.adaptor;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(CommonWrapper.prototype, \"metrics\", {\n    get: function () {\n      return this.factory.jax.math.metrics;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(CommonWrapper.prototype, \"fixesPWidth\", {\n    get: function () {\n      return !this.node.notParent && !this.node.isToken;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  CommonWrapper.prototype.wrap = function (node, parent) {\n    if (parent === void 0) {\n      parent = null;\n    }\n\n    var wrapped = this.factory.wrap(node, parent || this);\n\n    if (parent) {\n      parent.childNodes.push(wrapped);\n    }\n\n    this.jax.nodeMap.set(node, wrapped);\n    return wrapped;\n  };\n\n  CommonWrapper.prototype.getBBox = function (save) {\n    if (save === void 0) {\n      save = true;\n    }\n\n    if (this.bboxComputed) {\n      return this.bbox;\n    }\n\n    var bbox = save ? this.bbox : BBox_js_1.BBox.zero();\n    this.computeBBox(bbox);\n    this.bboxComputed = save;\n    return bbox;\n  };\n\n  CommonWrapper.prototype.computeBBox = function (bbox, recompute) {\n    var e_1, _a;\n\n    if (recompute === void 0) {\n      recompute = false;\n    }\n\n    bbox.empty();\n\n    try {\n      for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var child = _c.value;\n        bbox.append(child.getBBox());\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    bbox.clean();\n\n    if (this.fixesPWidth && this.setChildPWidths(recompute)) {\n      this.computeBBox(bbox, true);\n    }\n  };\n\n  CommonWrapper.prototype.setChildPWidths = function (recompute, w, clear) {\n    var e_2, _a;\n\n    if (w === void 0) {\n      w = null;\n    }\n\n    if (clear === void 0) {\n      clear = true;\n    }\n\n    if (recompute) {\n      return false;\n    }\n\n    if (clear) {\n      this.bbox.pwidth = '';\n    }\n\n    var changed = false;\n\n    try {\n      for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var child = _c.value;\n        var cbox = child.getBBox();\n\n        if (cbox.pwidth && child.setChildPWidths(recompute, w === null ? cbox.w : w, clear)) {\n          changed = true;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return changed;\n  };\n\n  CommonWrapper.prototype.invalidateBBox = function () {\n    if (this.bboxComputed) {\n      this.bboxComputed = false;\n\n      if (this.parent) {\n        this.parent.invalidateBBox();\n      }\n    }\n  };\n\n  CommonWrapper.prototype.copySkewIC = function (bbox) {\n    var first = this.childNodes[0];\n\n    if (first && first.bbox.sk) {\n      bbox.sk = first.bbox.sk;\n    }\n\n    var last = this.childNodes[this.childNodes.length - 1];\n\n    if (last && last.bbox.ic) {\n      bbox.ic = last.bbox.ic;\n      bbox.w += bbox.ic;\n    }\n  };\n\n  CommonWrapper.prototype.getStyles = function () {\n    var styleString = this.node.attributes.getExplicit('style');\n    if (!styleString) return;\n    var style = this.styles = new Styles_js_1.Styles(styleString);\n\n    for (var i = 0, m = CommonWrapper.removeStyles.length; i < m; i++) {\n      var id = CommonWrapper.removeStyles[i];\n\n      if (style.get(id)) {\n        if (!this.removedStyles) this.removedStyles = {};\n        this.removedStyles[id] = style.get(id);\n        style.set(id, '');\n      }\n    }\n  };\n\n  CommonWrapper.prototype.getVariant = function () {\n    if (!this.node.isToken) return;\n    var attributes = this.node.attributes;\n    var variant = attributes.get('mathvariant');\n\n    if (!attributes.getExplicit('mathvariant')) {\n      var values = attributes.getList('fontfamily', 'fontweight', 'fontstyle');\n\n      if (this.removedStyles) {\n        var style = this.removedStyles;\n        if (style.fontFamily) values.family = style.fontFamily;\n        if (style.fontWeight) values.weight = style.fontWeight;\n        if (style.fontStyle) values.style = style.fontStyle;\n      }\n\n      if (values.fontfamily) values.family = values.fontfamily;\n      if (values.fontweight) values.weight = values.fontweight;\n      if (values.fontstyle) values.style = values.fontstyle;\n\n      if (values.weight && values.weight.match(/^\\d+$/)) {\n        values.weight = parseInt(values.weight) > 600 ? 'bold' : 'normal';\n      }\n\n      if (values.family) {\n        variant = this.explicitVariant(values.family, values.weight, values.style);\n      } else {\n        if (this.node.getProperty('variantForm')) variant = '-tex-variant';\n        variant = (CommonWrapper.BOLDVARIANTS[values.weight] || {})[variant] || variant;\n        variant = (CommonWrapper.ITALICVARIANTS[values.style] || {})[variant] || variant;\n      }\n    }\n\n    this.variant = variant;\n  };\n\n  CommonWrapper.prototype.explicitVariant = function (fontFamily, fontWeight, fontStyle) {\n    var style = this.styles;\n    if (!style) style = this.styles = new Styles_js_1.Styles();\n    style.set('fontFamily', fontFamily);\n    if (fontWeight) style.set('fontWeight', fontWeight);\n    if (fontStyle) style.set('fontStyle', fontStyle);\n    return '-explicitFont';\n  };\n\n  CommonWrapper.prototype.getScale = function () {\n    var scale = 1,\n        parent = this.parent;\n    var pscale = parent ? parent.bbox.scale : 1;\n    var attributes = this.node.attributes;\n    var scriptlevel = Math.min(attributes.get('scriptlevel'), 2);\n    var fontsize = attributes.get('fontsize');\n    var mathsize = this.node.isToken || this.node.isKind('mstyle') ? attributes.get('mathsize') : attributes.getInherited('mathsize');\n\n    if (scriptlevel !== 0) {\n      scale = Math.pow(attributes.get('scriptsizemultiplier'), scriptlevel);\n      var scriptminsize = this.length2em(attributes.get('scriptminsize'), .8, 1);\n      if (scale < scriptminsize) scale = scriptminsize;\n    }\n\n    if (this.removedStyles && this.removedStyles.fontSize && !fontsize) {\n      fontsize = this.removedStyles.fontSize;\n    }\n\n    if (fontsize && !attributes.getExplicit('mathsize')) {\n      mathsize = fontsize;\n    }\n\n    if (mathsize !== '1') {\n      scale *= this.length2em(mathsize, 1, 1);\n    }\n\n    this.bbox.scale = scale;\n    this.bbox.rscale = scale / pscale;\n  };\n\n  CommonWrapper.prototype.getSpace = function () {\n    var isTop = this.isTopEmbellished();\n    var hasSpacing = this.node.hasSpacingAttributes();\n\n    if (this.jax.options.mathmlSpacing || hasSpacing) {\n      isTop && this.getMathMLSpacing();\n    } else {\n      this.getTeXSpacing(isTop, hasSpacing);\n    }\n  };\n\n  CommonWrapper.prototype.getMathMLSpacing = function () {\n    var node = this.node.coreMO();\n    var attributes = node.attributes;\n    var isScript = attributes.get('scriptlevel') > 0;\n    this.bbox.L = attributes.isSet('lspace') ? Math.max(0, this.length2em(attributes.get('lspace'))) : MathMLSpace(isScript, node.lspace);\n    this.bbox.R = attributes.isSet('rspace') ? Math.max(0, this.length2em(attributes.get('rspace'))) : MathMLSpace(isScript, node.rspace);\n  };\n\n  CommonWrapper.prototype.getTeXSpacing = function (isTop, hasSpacing) {\n    if (!hasSpacing) {\n      var space = this.node.texSpacing();\n\n      if (space) {\n        this.bbox.L = this.length2em(space);\n      }\n    }\n\n    if (isTop || hasSpacing) {\n      var attributes = this.node.coreMO().attributes;\n\n      if (attributes.isSet('lspace')) {\n        this.bbox.L = Math.max(0, this.length2em(attributes.get('lspace')));\n      }\n\n      if (attributes.isSet('rspace')) {\n        this.bbox.R = Math.max(0, this.length2em(attributes.get('rspace')));\n      }\n    }\n  };\n\n  CommonWrapper.prototype.isTopEmbellished = function () {\n    return this.node.isEmbellished && !(this.node.Parent && this.node.Parent.isEmbellished);\n  };\n\n  CommonWrapper.prototype.core = function () {\n    return this.jax.nodeMap.get(this.node.core());\n  };\n\n  CommonWrapper.prototype.coreMO = function () {\n    return this.jax.nodeMap.get(this.node.coreMO());\n  };\n\n  CommonWrapper.prototype.getText = function () {\n    var e_3, _a;\n\n    var text = '';\n\n    if (this.node.isToken) {\n      try {\n        for (var _b = __values(this.node.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n\n          if (child instanceof MmlNode_js_1.TextNode) {\n            text += child.getText();\n          }\n        }\n      } catch (e_3_1) {\n        e_3 = {\n          error: e_3_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_3) throw e_3.error;\n        }\n      }\n    }\n\n    return text;\n  };\n\n  CommonWrapper.prototype.canStretch = function (direction) {\n    this.stretch = FontData_js_1.NOSTRETCH;\n\n    if (this.node.isEmbellished) {\n      var core = this.core();\n\n      if (core && core.node !== this.node) {\n        if (core.canStretch(direction)) {\n          this.stretch = core.stretch;\n        }\n      }\n    }\n\n    return this.stretch.dir !== 0;\n  };\n\n  CommonWrapper.prototype.getAlignShift = function () {\n    var _a;\n\n    var _b = (_a = this.node.attributes).getList.apply(_a, __spread(MmlNode_js_1.indentAttributes)),\n        indentalign = _b.indentalign,\n        indentshift = _b.indentshift,\n        indentalignfirst = _b.indentalignfirst,\n        indentshiftfirst = _b.indentshiftfirst;\n\n    if (indentalignfirst !== 'indentalign') {\n      indentalign = indentalignfirst;\n    }\n\n    if (indentalign === 'auto') {\n      indentalign = this.jax.options.displayAlign;\n    }\n\n    if (indentshiftfirst !== 'indentshift') {\n      indentshift = indentshiftfirst;\n    }\n\n    if (indentshift === 'auto') {\n      indentshift = this.jax.options.displayIndent;\n\n      if (indentalign === 'right' && !indentshift.match(/^\\s*0[a-z]*\\s*$/)) {\n        indentshift = ('-' + indentshift.trim()).replace(/^--/, '');\n      }\n    }\n\n    var shift = this.length2em(indentshift, this.metrics.containerWidth);\n    return [indentalign, shift];\n  };\n\n  CommonWrapper.prototype.getAlignX = function (W, bbox, align) {\n    return align === 'right' ? W - (bbox.w + bbox.R) * bbox.rscale : align === 'left' ? bbox.L * bbox.rscale : (W - bbox.w * bbox.rscale) / 2;\n  };\n\n  CommonWrapper.prototype.getAlignY = function (H, D, h, d, align) {\n    return align === 'top' ? H - h : align === 'bottom' ? d - D : align === 'middle' ? (H - h - (D - d)) / 2 : 0;\n  };\n\n  CommonWrapper.prototype.getWrapWidth = function (i) {\n    return this.childNodes[i].getBBox().w;\n  };\n\n  CommonWrapper.prototype.getChildAlign = function (_i) {\n    return 'left';\n  };\n\n  CommonWrapper.prototype.percent = function (m) {\n    return LENGTHS.percent(m);\n  };\n\n  CommonWrapper.prototype.em = function (m) {\n    return LENGTHS.em(m);\n  };\n\n  CommonWrapper.prototype.px = function (m, M) {\n    if (M === void 0) {\n      M = -LENGTHS.BIGDIMEN;\n    }\n\n    return LENGTHS.px(m, M, this.metrics.em);\n  };\n\n  CommonWrapper.prototype.length2em = function (length, size, scale) {\n    if (size === void 0) {\n      size = 1;\n    }\n\n    if (scale === void 0) {\n      scale = null;\n    }\n\n    if (scale === null) {\n      scale = this.bbox.scale;\n    }\n\n    return LENGTHS.length2em(length, size, scale, this.jax.pxPerEm);\n  };\n\n  CommonWrapper.prototype.unicodeChars = function (text, name) {\n    if (name === void 0) {\n      name = this.variant;\n    }\n\n    var chars = string_js_1.unicodeChars(text);\n    var variant = this.font.getVariant(name);\n\n    if (variant && variant.chars) {\n      var map_1 = variant.chars;\n      chars = chars.map(function (n) {\n        return ((map_1[n] || [])[3] || {}).smp || n;\n      });\n    }\n\n    return chars;\n  };\n\n  CommonWrapper.prototype.remapChars = function (chars) {\n    return chars;\n  };\n\n  CommonWrapper.prototype.mmlText = function (text) {\n    return this.node.factory.create('text').setText(text);\n  };\n\n  CommonWrapper.prototype.mmlNode = function (kind, properties, children) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    if (children === void 0) {\n      children = [];\n    }\n\n    return this.node.factory.create(kind, properties, children);\n  };\n\n  CommonWrapper.prototype.createMo = function (text) {\n    var mmlFactory = this.node.factory;\n    var textNode = mmlFactory.create('text').setText(text);\n    var mml = mmlFactory.create('mo', {\n      stretchy: true\n    }, [textNode]);\n    mml.inheritAttributesFrom(this.node);\n    var node = this.wrap(mml);\n    node.parent = this;\n    return node;\n  };\n\n  CommonWrapper.prototype.getVariantChar = function (variant, n) {\n    var char = this.font.getChar(variant, n) || [0, 0, 0, {\n      unknown: true\n    }];\n\n    if (char.length === 3) {\n      char[3] = {};\n    }\n\n    return char;\n  };\n\n  CommonWrapper.kind = 'unknown';\n  CommonWrapper.styles = {};\n  CommonWrapper.removeStyles = ['fontSize', 'fontFamily', 'fontWeight', 'fontStyle', 'fontVariant', 'font'];\n  CommonWrapper.skipAttributes = {\n    fontfamily: true,\n    fontsize: true,\n    fontweight: true,\n    fontstyle: true,\n    color: true,\n    background: true,\n    'class': true,\n    href: true,\n    style: true,\n    xmlns: true\n  };\n  CommonWrapper.BOLDVARIANTS = {\n    bold: {\n      normal: 'bold',\n      italic: 'bold-italic',\n      fraktur: 'bold-fraktur',\n      script: 'bold-script',\n      'sans-serif': 'bold-sans-serif',\n      'sans-serif-italic': 'sans-serif-bold-italic'\n    },\n    normal: {\n      bold: 'normal',\n      'bold-italic': 'italic',\n      'bold-fraktur': 'fraktur',\n      'bold-script': 'script',\n      'bold-sans-serif': 'sans-serif',\n      'sans-serif-bold-italic': 'sans-serif-italic'\n    }\n  };\n  CommonWrapper.ITALICVARIANTS = {\n    italic: {\n      normal: 'italic',\n      bold: 'bold-italic',\n      'sans-serif': 'sans-serif-italic',\n      'bold-sans-serif': 'sans-serif-bold-italic'\n    },\n    normal: {\n      italic: 'normal',\n      'bold-italic': 'bold',\n      'sans-serif-italic': 'sans-serif',\n      'sans-serif-bold-italic': 'bold-sans-serif'\n    }\n  };\n  return CommonWrapper;\n}(Wrapper_js_1.AbstractWrapper);\n\nexports.CommonWrapper = CommonWrapper;","map":{"version":3,"sources":["../../../ts/output/common/Wrapper.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CommonWrapper = void 0;\nvar Wrapper_js_1 = require(\"../../core/Tree/Wrapper.js\");\nvar MmlNode_js_1 = require(\"../../core/MmlTree/MmlNode.js\");\nvar string_js_1 = require(\"../../util/string.js\");\nvar LENGTHS = require(\"../../util/lengths.js\");\nvar Styles_js_1 = require(\"../../util/Styles.js\");\nvar BBox_js_1 = require(\"../../util/BBox.js\");\nvar FontData_js_1 = require(\"./FontData.js\");\nvar SMALLSIZE = 2 / 18;\nfunction MathMLSpace(script, size) {\n    return (script ? size < SMALLSIZE ? 0 : SMALLSIZE : size);\n}\nvar CommonWrapper = (function (_super) {\n    __extends(CommonWrapper, _super);\n    function CommonWrapper(factory, node, parent) {\n        if (parent === void 0) { parent = null; }\n        var _this = _super.call(this, factory, node) || this;\n        _this.parent = null;\n        _this.removedStyles = null;\n        _this.styles = null;\n        _this.variant = '';\n        _this.bboxComputed = false;\n        _this.stretch = FontData_js_1.NOSTRETCH;\n        _this.font = null;\n        _this.parent = parent;\n        _this.font = factory.jax.font;\n        _this.bbox = BBox_js_1.BBox.zero();\n        _this.getStyles();\n        _this.getVariant();\n        _this.getScale();\n        _this.getSpace();\n        _this.childNodes = node.childNodes.map(function (child) {\n            var wrapped = _this.wrap(child);\n            if (wrapped.bbox.pwidth && (node.notParent || node.isKind('math'))) {\n                _this.bbox.pwidth = BBox_js_1.BBox.fullWidth;\n            }\n            return wrapped;\n        });\n        return _this;\n    }\n    Object.defineProperty(CommonWrapper.prototype, \"jax\", {\n        get: function () {\n            return this.factory.jax;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CommonWrapper.prototype, \"adaptor\", {\n        get: function () {\n            return this.factory.jax.adaptor;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CommonWrapper.prototype, \"metrics\", {\n        get: function () {\n            return this.factory.jax.math.metrics;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CommonWrapper.prototype, \"fixesPWidth\", {\n        get: function () {\n            return !this.node.notParent && !this.node.isToken;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CommonWrapper.prototype.wrap = function (node, parent) {\n        if (parent === void 0) { parent = null; }\n        var wrapped = this.factory.wrap(node, parent || this);\n        if (parent) {\n            parent.childNodes.push(wrapped);\n        }\n        this.jax.nodeMap.set(node, wrapped);\n        return wrapped;\n    };\n    CommonWrapper.prototype.getBBox = function (save) {\n        if (save === void 0) { save = true; }\n        if (this.bboxComputed) {\n            return this.bbox;\n        }\n        var bbox = (save ? this.bbox : BBox_js_1.BBox.zero());\n        this.computeBBox(bbox);\n        this.bboxComputed = save;\n        return bbox;\n    };\n    CommonWrapper.prototype.computeBBox = function (bbox, recompute) {\n        var e_1, _a;\n        if (recompute === void 0) { recompute = false; }\n        bbox.empty();\n        try {\n            for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var child = _c.value;\n                bbox.append(child.getBBox());\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        bbox.clean();\n        if (this.fixesPWidth && this.setChildPWidths(recompute)) {\n            this.computeBBox(bbox, true);\n        }\n    };\n    CommonWrapper.prototype.setChildPWidths = function (recompute, w, clear) {\n        var e_2, _a;\n        if (w === void 0) { w = null; }\n        if (clear === void 0) { clear = true; }\n        if (recompute) {\n            return false;\n        }\n        if (clear) {\n            this.bbox.pwidth = '';\n        }\n        var changed = false;\n        try {\n            for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var child = _c.value;\n                var cbox = child.getBBox();\n                if (cbox.pwidth && child.setChildPWidths(recompute, w === null ? cbox.w : w, clear)) {\n                    changed = true;\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return changed;\n    };\n    CommonWrapper.prototype.invalidateBBox = function () {\n        if (this.bboxComputed) {\n            this.bboxComputed = false;\n            if (this.parent) {\n                this.parent.invalidateBBox();\n            }\n        }\n    };\n    CommonWrapper.prototype.copySkewIC = function (bbox) {\n        var first = this.childNodes[0];\n        if (first && first.bbox.sk) {\n            bbox.sk = first.bbox.sk;\n        }\n        var last = this.childNodes[this.childNodes.length - 1];\n        if (last && last.bbox.ic) {\n            bbox.ic = last.bbox.ic;\n            bbox.w += bbox.ic;\n        }\n    };\n    CommonWrapper.prototype.getStyles = function () {\n        var styleString = this.node.attributes.getExplicit('style');\n        if (!styleString)\n            return;\n        var style = this.styles = new Styles_js_1.Styles(styleString);\n        for (var i = 0, m = CommonWrapper.removeStyles.length; i < m; i++) {\n            var id = CommonWrapper.removeStyles[i];\n            if (style.get(id)) {\n                if (!this.removedStyles)\n                    this.removedStyles = {};\n                this.removedStyles[id] = style.get(id);\n                style.set(id, '');\n            }\n        }\n    };\n    CommonWrapper.prototype.getVariant = function () {\n        if (!this.node.isToken)\n            return;\n        var attributes = this.node.attributes;\n        var variant = attributes.get('mathvariant');\n        if (!attributes.getExplicit('mathvariant')) {\n            var values = attributes.getList('fontfamily', 'fontweight', 'fontstyle');\n            if (this.removedStyles) {\n                var style = this.removedStyles;\n                if (style.fontFamily)\n                    values.family = style.fontFamily;\n                if (style.fontWeight)\n                    values.weight = style.fontWeight;\n                if (style.fontStyle)\n                    values.style = style.fontStyle;\n            }\n            if (values.fontfamily)\n                values.family = values.fontfamily;\n            if (values.fontweight)\n                values.weight = values.fontweight;\n            if (values.fontstyle)\n                values.style = values.fontstyle;\n            if (values.weight && values.weight.match(/^\\d+$/)) {\n                values.weight = (parseInt(values.weight) > 600 ? 'bold' : 'normal');\n            }\n            if (values.family) {\n                variant = this.explicitVariant(values.family, values.weight, values.style);\n            }\n            else {\n                if (this.node.getProperty('variantForm'))\n                    variant = '-tex-variant';\n                variant = (CommonWrapper.BOLDVARIANTS[values.weight] || {})[variant] || variant;\n                variant = (CommonWrapper.ITALICVARIANTS[values.style] || {})[variant] || variant;\n            }\n        }\n        this.variant = variant;\n    };\n    CommonWrapper.prototype.explicitVariant = function (fontFamily, fontWeight, fontStyle) {\n        var style = this.styles;\n        if (!style)\n            style = this.styles = new Styles_js_1.Styles();\n        style.set('fontFamily', fontFamily);\n        if (fontWeight)\n            style.set('fontWeight', fontWeight);\n        if (fontStyle)\n            style.set('fontStyle', fontStyle);\n        return '-explicitFont';\n    };\n    CommonWrapper.prototype.getScale = function () {\n        var scale = 1, parent = this.parent;\n        var pscale = (parent ? parent.bbox.scale : 1);\n        var attributes = this.node.attributes;\n        var scriptlevel = Math.min(attributes.get('scriptlevel'), 2);\n        var fontsize = attributes.get('fontsize');\n        var mathsize = (this.node.isToken || this.node.isKind('mstyle') ?\n            attributes.get('mathsize') : attributes.getInherited('mathsize'));\n        if (scriptlevel !== 0) {\n            scale = Math.pow(attributes.get('scriptsizemultiplier'), scriptlevel);\n            var scriptminsize = this.length2em(attributes.get('scriptminsize'), .8, 1);\n            if (scale < scriptminsize)\n                scale = scriptminsize;\n        }\n        if (this.removedStyles && this.removedStyles.fontSize && !fontsize) {\n            fontsize = this.removedStyles.fontSize;\n        }\n        if (fontsize && !attributes.getExplicit('mathsize')) {\n            mathsize = fontsize;\n        }\n        if (mathsize !== '1') {\n            scale *= this.length2em(mathsize, 1, 1);\n        }\n        this.bbox.scale = scale;\n        this.bbox.rscale = scale / pscale;\n    };\n    CommonWrapper.prototype.getSpace = function () {\n        var isTop = this.isTopEmbellished();\n        var hasSpacing = this.node.hasSpacingAttributes();\n        if (this.jax.options.mathmlSpacing || hasSpacing) {\n            isTop && this.getMathMLSpacing();\n        }\n        else {\n            this.getTeXSpacing(isTop, hasSpacing);\n        }\n    };\n    CommonWrapper.prototype.getMathMLSpacing = function () {\n        var node = this.node.coreMO();\n        var attributes = node.attributes;\n        var isScript = (attributes.get('scriptlevel') > 0);\n        this.bbox.L = (attributes.isSet('lspace') ?\n            Math.max(0, this.length2em(attributes.get('lspace'))) :\n            MathMLSpace(isScript, node.lspace));\n        this.bbox.R = (attributes.isSet('rspace') ?\n            Math.max(0, this.length2em(attributes.get('rspace'))) :\n            MathMLSpace(isScript, node.rspace));\n    };\n    CommonWrapper.prototype.getTeXSpacing = function (isTop, hasSpacing) {\n        if (!hasSpacing) {\n            var space = this.node.texSpacing();\n            if (space) {\n                this.bbox.L = this.length2em(space);\n            }\n        }\n        if (isTop || hasSpacing) {\n            var attributes = this.node.coreMO().attributes;\n            if (attributes.isSet('lspace')) {\n                this.bbox.L = Math.max(0, this.length2em(attributes.get('lspace')));\n            }\n            if (attributes.isSet('rspace')) {\n                this.bbox.R = Math.max(0, this.length2em(attributes.get('rspace')));\n            }\n        }\n    };\n    CommonWrapper.prototype.isTopEmbellished = function () {\n        return (this.node.isEmbellished &&\n            !(this.node.Parent && this.node.Parent.isEmbellished));\n    };\n    CommonWrapper.prototype.core = function () {\n        return this.jax.nodeMap.get(this.node.core());\n    };\n    CommonWrapper.prototype.coreMO = function () {\n        return this.jax.nodeMap.get(this.node.coreMO());\n    };\n    CommonWrapper.prototype.getText = function () {\n        var e_3, _a;\n        var text = '';\n        if (this.node.isToken) {\n            try {\n                for (var _b = __values(this.node.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                    var child = _c.value;\n                    if (child instanceof MmlNode_js_1.TextNode) {\n                        text += child.getText();\n                    }\n                }\n            }\n            catch (e_3_1) { e_3 = { error: e_3_1 }; }\n            finally {\n                try {\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                }\n                finally { if (e_3) throw e_3.error; }\n            }\n        }\n        return text;\n    };\n    CommonWrapper.prototype.canStretch = function (direction) {\n        this.stretch = FontData_js_1.NOSTRETCH;\n        if (this.node.isEmbellished) {\n            var core = this.core();\n            if (core && core.node !== this.node) {\n                if (core.canStretch(direction)) {\n                    this.stretch = core.stretch;\n                }\n            }\n        }\n        return this.stretch.dir !== 0;\n    };\n    CommonWrapper.prototype.getAlignShift = function () {\n        var _a;\n        var _b = (_a = this.node.attributes).getList.apply(_a, __spread(MmlNode_js_1.indentAttributes)), indentalign = _b.indentalign, indentshift = _b.indentshift, indentalignfirst = _b.indentalignfirst, indentshiftfirst = _b.indentshiftfirst;\n        if (indentalignfirst !== 'indentalign') {\n            indentalign = indentalignfirst;\n        }\n        if (indentalign === 'auto') {\n            indentalign = this.jax.options.displayAlign;\n        }\n        if (indentshiftfirst !== 'indentshift') {\n            indentshift = indentshiftfirst;\n        }\n        if (indentshift === 'auto') {\n            indentshift = this.jax.options.displayIndent;\n            if (indentalign === 'right' && !indentshift.match(/^\\s*0[a-z]*\\s*$/)) {\n                indentshift = ('-' + indentshift.trim()).replace(/^--/, '');\n            }\n        }\n        var shift = this.length2em(indentshift, this.metrics.containerWidth);\n        return [indentalign, shift];\n    };\n    CommonWrapper.prototype.getAlignX = function (W, bbox, align) {\n        return (align === 'right' ? W - (bbox.w + bbox.R) * bbox.rscale :\n            align === 'left' ? bbox.L * bbox.rscale :\n                (W - bbox.w * bbox.rscale) / 2);\n    };\n    CommonWrapper.prototype.getAlignY = function (H, D, h, d, align) {\n        return (align === 'top' ? H - h :\n            align === 'bottom' ? d - D :\n                align === 'middle' ? ((H - h) - (D - d)) / 2 :\n                    0);\n    };\n    CommonWrapper.prototype.getWrapWidth = function (i) {\n        return this.childNodes[i].getBBox().w;\n    };\n    CommonWrapper.prototype.getChildAlign = function (_i) {\n        return 'left';\n    };\n    CommonWrapper.prototype.percent = function (m) {\n        return LENGTHS.percent(m);\n    };\n    CommonWrapper.prototype.em = function (m) {\n        return LENGTHS.em(m);\n    };\n    CommonWrapper.prototype.px = function (m, M) {\n        if (M === void 0) { M = -LENGTHS.BIGDIMEN; }\n        return LENGTHS.px(m, M, this.metrics.em);\n    };\n    CommonWrapper.prototype.length2em = function (length, size, scale) {\n        if (size === void 0) { size = 1; }\n        if (scale === void 0) { scale = null; }\n        if (scale === null) {\n            scale = this.bbox.scale;\n        }\n        return LENGTHS.length2em(length, size, scale, this.jax.pxPerEm);\n    };\n    CommonWrapper.prototype.unicodeChars = function (text, name) {\n        if (name === void 0) { name = this.variant; }\n        var chars = string_js_1.unicodeChars(text);\n        var variant = this.font.getVariant(name);\n        if (variant && variant.chars) {\n            var map_1 = variant.chars;\n            chars = chars.map(function (n) { return ((map_1[n] || [])[3] || {}).smp || n; });\n        }\n        return chars;\n    };\n    CommonWrapper.prototype.remapChars = function (chars) {\n        return chars;\n    };\n    CommonWrapper.prototype.mmlText = function (text) {\n        return this.node.factory.create('text').setText(text);\n    };\n    CommonWrapper.prototype.mmlNode = function (kind, properties, children) {\n        if (properties === void 0) { properties = {}; }\n        if (children === void 0) { children = []; }\n        return this.node.factory.create(kind, properties, children);\n    };\n    CommonWrapper.prototype.createMo = function (text) {\n        var mmlFactory = this.node.factory;\n        var textNode = mmlFactory.create('text').setText(text);\n        var mml = mmlFactory.create('mo', { stretchy: true }, [textNode]);\n        mml.inheritAttributesFrom(this.node);\n        var node = this.wrap(mml);\n        node.parent = this;\n        return node;\n    };\n    CommonWrapper.prototype.getVariantChar = function (variant, n) {\n        var char = this.font.getChar(variant, n) || [0, 0, 0, { unknown: true }];\n        if (char.length === 3) {\n            char[3] = {};\n        }\n        return char;\n    };\n    CommonWrapper.kind = 'unknown';\n    CommonWrapper.styles = {};\n    CommonWrapper.removeStyles = [\n        'fontSize', 'fontFamily', 'fontWeight',\n        'fontStyle', 'fontVariant', 'font'\n    ];\n    CommonWrapper.skipAttributes = {\n        fontfamily: true, fontsize: true, fontweight: true, fontstyle: true,\n        color: true, background: true,\n        'class': true, href: true, style: true,\n        xmlns: true\n    };\n    CommonWrapper.BOLDVARIANTS = {\n        bold: {\n            normal: 'bold',\n            italic: 'bold-italic',\n            fraktur: 'bold-fraktur',\n            script: 'bold-script',\n            'sans-serif': 'bold-sans-serif',\n            'sans-serif-italic': 'sans-serif-bold-italic'\n        },\n        normal: {\n            bold: 'normal',\n            'bold-italic': 'italic',\n            'bold-fraktur': 'fraktur',\n            'bold-script': 'script',\n            'bold-sans-serif': 'sans-serif',\n            'sans-serif-bold-italic': 'sans-serif-italic'\n        }\n    };\n    CommonWrapper.ITALICVARIANTS = {\n        italic: {\n            normal: 'italic',\n            bold: 'bold-italic',\n            'sans-serif': 'sans-serif-italic',\n            'bold-sans-serif': 'sans-serif-bold-italic'\n        },\n        normal: {\n            italic: 'normal',\n            'bold-italic': 'bold',\n            'sans-serif-italic': 'sans-serif',\n            'sans-serif-bold-italic': 'bold-sans-serif'\n        }\n    };\n    return CommonWrapper;\n}(Wrapper_js_1.AbstractWrapper));\nexports.CommonWrapper = CommonWrapper;\n//# sourceMappingURL=Wrapper.js.map"]},"metadata":{},"sourceType":"script"}