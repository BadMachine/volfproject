{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SVG = exports.XLINKNS = exports.SVGNS = void 0;\n\nvar OutputJax_js_1 = require(\"./common/OutputJax.js\");\n\nvar WrapperFactory_js_1 = require(\"./svg/WrapperFactory.js\");\n\nvar tex_js_1 = require(\"./svg/fonts/tex.js\");\n\nvar FontCache_js_1 = require(\"./svg/FontCache.js\");\n\nvar string_js_1 = require(\"../util/string.js\");\n\nvar lengths_js_1 = require(\"../util/lengths.js\");\n\nexports.SVGNS = 'http://www.w3.org/2000/svg';\nexports.XLINKNS = 'http://www.w3.org/1999/xlink';\n\nvar SVG = function (_super) {\n  __extends(SVG, _super);\n\n  function SVG(options) {\n    if (options === void 0) {\n      options = null;\n    }\n\n    var _this = _super.call(this, options, WrapperFactory_js_1.SVGWrapperFactory, tex_js_1.TeXFont) || this;\n\n    _this.minwidth = 0;\n    _this.shift = 0;\n    _this.container = null;\n    _this.svgStyles = null;\n    _this.fontCache = new FontCache_js_1.FontCache(_this);\n    return _this;\n  }\n\n  SVG.prototype.initialize = function () {\n    if (this.options.fontCache === 'global') {\n      this.fontCache.clearCache();\n    }\n  };\n\n  SVG.prototype.clearFontCache = function () {\n    this.fontCache.clearCache();\n  };\n\n  SVG.prototype.setScale = function (node) {\n    if (this.options.scale !== 1) {\n      this.adaptor.setStyle(node, 'fontSize', lengths_js_1.percent(this.options.scale));\n    }\n  };\n\n  SVG.prototype.escaped = function (math, html) {\n    this.setDocument(html);\n    return this.html('span', {}, [this.text(math.math)]);\n  };\n\n  SVG.prototype.styleSheet = function (html) {\n    if (this.svgStyles) {\n      return null;\n    }\n\n    var sheet = this.svgStyles = _super.prototype.styleSheet.call(this, html);\n\n    this.adaptor.setAttribute(sheet, 'id', SVG.STYLESHEETID);\n    return sheet;\n  };\n\n  SVG.prototype.pageElements = function (html) {\n    if (this.options.fontCache === 'global' && !this.findCache(html)) {\n      return this.svg('svg', {\n        id: SVG.FONTCACHEID,\n        style: {\n          display: 'none'\n        }\n      }, [this.fontCache.getCache()]);\n    }\n\n    return null;\n  };\n\n  SVG.prototype.findCache = function (html) {\n    var adaptor = this.adaptor;\n    var svgs = adaptor.tags(adaptor.body(html.document), 'svg');\n\n    for (var i = svgs.length - 1; i >= 0; i--) {\n      if (this.adaptor.getAttribute(svgs[i], 'id') === SVG.FONTCACHEID) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  SVG.prototype.processMath = function (math, parent) {\n    var container = this.container;\n    this.container = parent;\n    var wrapper = this.factory.wrap(math);\n\n    var _a = __read(this.createRoot(wrapper), 2),\n        svg = _a[0],\n        g = _a[1];\n\n    this.typesetSVG(wrapper, svg, g);\n    this.container = container;\n  };\n\n  SVG.prototype.createRoot = function (wrapper) {\n    var _a = wrapper.getBBox(),\n        w = _a.w,\n        h = _a.h,\n        d = _a.d,\n        pwidth = _a.pwidth;\n\n    var W = Math.max(w, .001);\n    var g = this.svg('g', {\n      stroke: 'currentColor',\n      fill: 'currentColor',\n      'stroke-width': 0,\n      transform: 'matrix(1 0 0 -1 0 0)'\n    });\n    var adaptor = this.adaptor;\n    var svg = adaptor.append(this.container, this.svg('svg', {\n      xmlns: exports.SVGNS,\n      width: this.ex(W),\n      height: this.ex(h + d),\n      role: 'img',\n      focusable: false,\n      style: {\n        'vertical-align': this.ex(-d)\n      },\n      viewBox: [0, this.fixed(-h * 1000, 1), this.fixed(W * 1000, 1), this.fixed((h + d) * 1000, 1)].join(' ')\n    }, [g]));\n\n    if (W === .001) {\n      adaptor.setAttribute(svg, 'preserveAspectRatio', 'xMidYMid slice');\n\n      if (w < 0) {\n        adaptor.setStyle(this.container, 'margin-right', this.ex(w));\n      }\n    }\n\n    if (pwidth) {\n      adaptor.setStyle(svg, 'min-width', this.ex(W));\n      adaptor.setAttribute(svg, 'width', pwidth);\n      adaptor.removeAttribute(svg, 'viewBox');\n      var scale = wrapper.metrics.ex / (this.font.params.x_height * 1000);\n      adaptor.setAttribute(g, 'transform', 'matrix(1 0 0 -1 0 0) scale(' + this.fixed(scale, 6) + ') translate(0, ' + this.fixed(-h * 1000, 1) + ')');\n    }\n\n    if (this.options.fontCache !== 'none') {\n      adaptor.setAttribute(svg, 'xmlns:xlink', exports.XLINKNS);\n    }\n\n    return [svg, g];\n  };\n\n  SVG.prototype.typesetSVG = function (wrapper, svg, g) {\n    var adaptor = this.adaptor;\n    this.minwidth = this.shift = 0;\n\n    if (this.options.fontCache === 'local') {\n      this.fontCache.clearCache();\n      this.fontCache.useLocalID(this.options.localID);\n      adaptor.insert(this.fontCache.getCache(), g);\n    }\n\n    wrapper.toSVG(g);\n    this.fontCache.clearLocalID();\n\n    if (this.minwidth) {\n      adaptor.setStyle(svg, 'minWidth', this.ex(this.minwidth));\n      adaptor.setStyle(this.container, 'minWidth', this.ex(this.minwidth));\n    } else if (this.shift) {\n      var align = adaptor.getAttribute(this.container, 'justify') || 'center';\n      this.setIndent(svg, align, this.shift);\n    }\n  };\n\n  SVG.prototype.setIndent = function (svg, align, shift) {\n    if (align === 'center' || align === 'left') {\n      this.adaptor.setStyle(svg, 'margin-left', this.ex(shift));\n    }\n\n    if (align === 'center' || align === 'right') {\n      this.adaptor.setStyle(svg, 'margin-right', this.ex(-shift));\n    }\n  };\n\n  SVG.prototype.ex = function (m) {\n    m /= this.font.params.x_height;\n    return Math.abs(m) < .001 ? '0' : m.toFixed(3).replace(/\\.?0+$/, '') + 'ex';\n  };\n\n  SVG.prototype.svg = function (kind, properties, children) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    if (children === void 0) {\n      children = [];\n    }\n\n    return this.html(kind, properties, children, exports.SVGNS);\n  };\n\n  SVG.prototype.unknownText = function (text, variant) {\n    var metrics = this.math.metrics;\n    var scale = this.font.params.x_height / metrics.ex * metrics.em * 1000;\n    var svg = this.svg('text', {\n      'data-variant': variant,\n      transform: 'matrix(1 0 0 -1 0 0)',\n      'font-size': this.fixed(scale, 1) + 'px'\n    }, [this.text(text)]);\n    var adaptor = this.adaptor;\n\n    if (variant !== '-explicitFont') {\n      var c = string_js_1.unicodeChars(text);\n\n      if (c.length !== 1 || c[0] < 0x1D400 || c[0] > 0x1D7FF) {\n        var _a = __read(this.font.getCssFont(variant), 3),\n            family = _a[0],\n            italic = _a[1],\n            bold = _a[2];\n\n        adaptor.setAttribute(svg, 'font-family', family);\n\n        if (italic) {\n          adaptor.setAttribute(svg, 'font-style', 'italic');\n        }\n\n        if (bold) {\n          adaptor.setAttribute(svg, 'font-weight', 'bold');\n        }\n      }\n    }\n\n    return svg;\n  };\n\n  SVG.prototype.measureTextNode = function (text) {\n    var adaptor = this.adaptor;\n    text = adaptor.clone(text);\n    adaptor.removeAttribute(text, 'transform');\n    var ex = this.fixed(this.font.params.x_height * 1000, 1);\n    var svg = this.svg('svg', {\n      position: 'absolute',\n      visibility: 'hidden',\n      width: '1ex',\n      height: '1ex',\n      viewBox: [0, 0, ex, ex].join(' ')\n    }, [text]);\n    adaptor.append(adaptor.body(adaptor.document), svg);\n    var w = adaptor.nodeSize(text, 1000, true)[0];\n    adaptor.remove(svg);\n    return {\n      w: w,\n      h: .75,\n      d: .2\n    };\n  };\n\n  SVG.NAME = 'SVG';\n  SVG.OPTIONS = __assign(__assign({}, OutputJax_js_1.CommonOutputJax.OPTIONS), {\n    internalSpeechTitles: true,\n    titleID: 0,\n    fontCache: 'local',\n    localID: null\n  });\n  SVG.commonStyles = {\n    'mjx-container[jax=\"SVG\"]': {\n      direction: 'ltr'\n    },\n    'mjx-container[jax=\"SVG\"] > svg': {\n      overflow: 'visible'\n    },\n    'mjx-container[jax=\"SVG\"] > svg a': {\n      fill: 'blue',\n      stroke: 'blue'\n    }\n  };\n  SVG.FONTCACHEID = 'MJX-SVG-global-cache';\n  SVG.STYLESHEETID = 'MJX-SVG-styles';\n  return SVG;\n}(OutputJax_js_1.CommonOutputJax);\n\nexports.SVG = SVG;","map":{"version":3,"sources":["../../ts/output/svg.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SVG = exports.XLINKNS = exports.SVGNS = void 0;\nvar OutputJax_js_1 = require(\"./common/OutputJax.js\");\nvar WrapperFactory_js_1 = require(\"./svg/WrapperFactory.js\");\nvar tex_js_1 = require(\"./svg/fonts/tex.js\");\nvar FontCache_js_1 = require(\"./svg/FontCache.js\");\nvar string_js_1 = require(\"../util/string.js\");\nvar lengths_js_1 = require(\"../util/lengths.js\");\nexports.SVGNS = 'http://www.w3.org/2000/svg';\nexports.XLINKNS = 'http://www.w3.org/1999/xlink';\nvar SVG = (function (_super) {\n    __extends(SVG, _super);\n    function SVG(options) {\n        if (options === void 0) { options = null; }\n        var _this = _super.call(this, options, WrapperFactory_js_1.SVGWrapperFactory, tex_js_1.TeXFont) || this;\n        _this.minwidth = 0;\n        _this.shift = 0;\n        _this.container = null;\n        _this.svgStyles = null;\n        _this.fontCache = new FontCache_js_1.FontCache(_this);\n        return _this;\n    }\n    SVG.prototype.initialize = function () {\n        if (this.options.fontCache === 'global') {\n            this.fontCache.clearCache();\n        }\n    };\n    SVG.prototype.clearFontCache = function () {\n        this.fontCache.clearCache();\n    };\n    SVG.prototype.setScale = function (node) {\n        if (this.options.scale !== 1) {\n            this.adaptor.setStyle(node, 'fontSize', lengths_js_1.percent(this.options.scale));\n        }\n    };\n    SVG.prototype.escaped = function (math, html) {\n        this.setDocument(html);\n        return this.html('span', {}, [this.text(math.math)]);\n    };\n    SVG.prototype.styleSheet = function (html) {\n        if (this.svgStyles) {\n            return null;\n        }\n        var sheet = this.svgStyles = _super.prototype.styleSheet.call(this, html);\n        this.adaptor.setAttribute(sheet, 'id', SVG.STYLESHEETID);\n        return sheet;\n    };\n    SVG.prototype.pageElements = function (html) {\n        if (this.options.fontCache === 'global' && !this.findCache(html)) {\n            return this.svg('svg', { id: SVG.FONTCACHEID, style: { display: 'none' } }, [this.fontCache.getCache()]);\n        }\n        return null;\n    };\n    SVG.prototype.findCache = function (html) {\n        var adaptor = this.adaptor;\n        var svgs = adaptor.tags(adaptor.body(html.document), 'svg');\n        for (var i = svgs.length - 1; i >= 0; i--) {\n            if (this.adaptor.getAttribute(svgs[i], 'id') === SVG.FONTCACHEID) {\n                return true;\n            }\n        }\n        return false;\n    };\n    SVG.prototype.processMath = function (math, parent) {\n        var container = this.container;\n        this.container = parent;\n        var wrapper = this.factory.wrap(math);\n        var _a = __read(this.createRoot(wrapper), 2), svg = _a[0], g = _a[1];\n        this.typesetSVG(wrapper, svg, g);\n        this.container = container;\n    };\n    SVG.prototype.createRoot = function (wrapper) {\n        var _a = wrapper.getBBox(), w = _a.w, h = _a.h, d = _a.d, pwidth = _a.pwidth;\n        var W = Math.max(w, .001);\n        var g = this.svg('g', {\n            stroke: 'currentColor', fill: 'currentColor',\n            'stroke-width': 0, transform: 'matrix(1 0 0 -1 0 0)'\n        });\n        var adaptor = this.adaptor;\n        var svg = adaptor.append(this.container, this.svg('svg', {\n            xmlns: exports.SVGNS,\n            width: this.ex(W), height: this.ex(h + d),\n            role: 'img', focusable: false,\n            style: { 'vertical-align': this.ex(-d) },\n            viewBox: [0, this.fixed(-h * 1000, 1), this.fixed(W * 1000, 1), this.fixed((h + d) * 1000, 1)].join(' ')\n        }, [g]));\n        if (W === .001) {\n            adaptor.setAttribute(svg, 'preserveAspectRatio', 'xMidYMid slice');\n            if (w < 0) {\n                adaptor.setStyle(this.container, 'margin-right', this.ex(w));\n            }\n        }\n        if (pwidth) {\n            adaptor.setStyle(svg, 'min-width', this.ex(W));\n            adaptor.setAttribute(svg, 'width', pwidth);\n            adaptor.removeAttribute(svg, 'viewBox');\n            var scale = wrapper.metrics.ex / (this.font.params.x_height * 1000);\n            adaptor.setAttribute(g, 'transform', 'matrix(1 0 0 -1 0 0) scale(' +\n                this.fixed(scale, 6) + ') translate(0, ' + this.fixed(-h * 1000, 1) + ')');\n        }\n        if (this.options.fontCache !== 'none') {\n            adaptor.setAttribute(svg, 'xmlns:xlink', exports.XLINKNS);\n        }\n        return [svg, g];\n    };\n    SVG.prototype.typesetSVG = function (wrapper, svg, g) {\n        var adaptor = this.adaptor;\n        this.minwidth = this.shift = 0;\n        if (this.options.fontCache === 'local') {\n            this.fontCache.clearCache();\n            this.fontCache.useLocalID(this.options.localID);\n            adaptor.insert(this.fontCache.getCache(), g);\n        }\n        wrapper.toSVG(g);\n        this.fontCache.clearLocalID();\n        if (this.minwidth) {\n            adaptor.setStyle(svg, 'minWidth', this.ex(this.minwidth));\n            adaptor.setStyle(this.container, 'minWidth', this.ex(this.minwidth));\n        }\n        else if (this.shift) {\n            var align = adaptor.getAttribute(this.container, 'justify') || 'center';\n            this.setIndent(svg, align, this.shift);\n        }\n    };\n    SVG.prototype.setIndent = function (svg, align, shift) {\n        if (align === 'center' || align === 'left') {\n            this.adaptor.setStyle(svg, 'margin-left', this.ex(shift));\n        }\n        if (align === 'center' || align === 'right') {\n            this.adaptor.setStyle(svg, 'margin-right', this.ex(-shift));\n        }\n    };\n    SVG.prototype.ex = function (m) {\n        m /= this.font.params.x_height;\n        return (Math.abs(m) < .001 ? '0' : m.toFixed(3).replace(/\\.?0+$/, '') + 'ex');\n    };\n    SVG.prototype.svg = function (kind, properties, children) {\n        if (properties === void 0) { properties = {}; }\n        if (children === void 0) { children = []; }\n        return this.html(kind, properties, children, exports.SVGNS);\n    };\n    SVG.prototype.unknownText = function (text, variant) {\n        var metrics = this.math.metrics;\n        var scale = this.font.params.x_height / metrics.ex * metrics.em * 1000;\n        var svg = this.svg('text', {\n            'data-variant': variant,\n            transform: 'matrix(1 0 0 -1 0 0)', 'font-size': this.fixed(scale, 1) + 'px'\n        }, [this.text(text)]);\n        var adaptor = this.adaptor;\n        if (variant !== '-explicitFont') {\n            var c = string_js_1.unicodeChars(text);\n            if (c.length !== 1 || c[0] < 0x1D400 || c[0] > 0x1D7FF) {\n                var _a = __read(this.font.getCssFont(variant), 3), family = _a[0], italic = _a[1], bold = _a[2];\n                adaptor.setAttribute(svg, 'font-family', family);\n                if (italic) {\n                    adaptor.setAttribute(svg, 'font-style', 'italic');\n                }\n                if (bold) {\n                    adaptor.setAttribute(svg, 'font-weight', 'bold');\n                }\n            }\n        }\n        return svg;\n    };\n    SVG.prototype.measureTextNode = function (text) {\n        var adaptor = this.adaptor;\n        text = adaptor.clone(text);\n        adaptor.removeAttribute(text, 'transform');\n        var ex = this.fixed(this.font.params.x_height * 1000, 1);\n        var svg = this.svg('svg', {\n            position: 'absolute', visibility: 'hidden',\n            width: '1ex', height: '1ex',\n            viewBox: [0, 0, ex, ex].join(' ')\n        }, [text]);\n        adaptor.append(adaptor.body(adaptor.document), svg);\n        var w = adaptor.nodeSize(text, 1000, true)[0];\n        adaptor.remove(svg);\n        return { w: w, h: .75, d: .2 };\n    };\n    SVG.NAME = 'SVG';\n    SVG.OPTIONS = __assign(__assign({}, OutputJax_js_1.CommonOutputJax.OPTIONS), { internalSpeechTitles: true, titleID: 0, fontCache: 'local', localID: null });\n    SVG.commonStyles = {\n        'mjx-container[jax=\"SVG\"]': {\n            direction: 'ltr'\n        },\n        'mjx-container[jax=\"SVG\"] > svg': {\n            overflow: 'visible'\n        },\n        'mjx-container[jax=\"SVG\"] > svg a': {\n            fill: 'blue', stroke: 'blue'\n        }\n    };\n    SVG.FONTCACHEID = 'MJX-SVG-global-cache';\n    SVG.STYLESHEETID = 'MJX-SVG-styles';\n    return SVG;\n}(OutputJax_js_1.CommonOutputJax));\nexports.SVG = SVG;\n//# sourceMappingURL=svg.js.map"]},"metadata":{},"sourceType":"script"}