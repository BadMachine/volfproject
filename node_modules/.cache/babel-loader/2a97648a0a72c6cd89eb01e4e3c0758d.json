{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommonMmultiscriptsMixin = exports.ScriptNames = exports.NextScript = void 0;\n\nvar BBox_js_1 = require(\"../../../util/BBox.js\");\n\nexports.NextScript = {\n  base: 'subList',\n  subList: 'supList',\n  supList: 'subList',\n  psubList: 'psupList',\n  psupList: 'psubList'\n};\nexports.ScriptNames = ['sup', 'sup', 'psup', 'psub'];\n\nfunction CommonMmultiscriptsMixin(Base) {\n  return function (_super) {\n    __extends(class_1, _super);\n\n    function class_1() {\n      var _this = _super !== null && _super.apply(this, arguments) || this;\n\n      _this.scriptData = null;\n      _this.firstPrescript = 0;\n      return _this;\n    }\n\n    class_1.prototype.combinePrePost = function (pre, post) {\n      var bbox = new BBox_js_1.BBox(pre);\n      bbox.combine(post, 0, 0);\n      return bbox;\n    };\n\n    class_1.prototype.computeBBox = function (bbox, recompute) {\n      if (recompute === void 0) {\n        recompute = false;\n      }\n\n      var scriptspace = this.font.params.scriptspace;\n      var data = this.getScriptData();\n      var sub = this.combinePrePost(data.sub, data.psub);\n      var sup = this.combinePrePost(data.sup, data.psup);\n\n      var _a = __read(this.getUVQ(data.base, sub, sup), 2),\n          u = _a[0],\n          v = _a[1];\n\n      bbox.empty();\n\n      if (data.numPrescripts) {\n        bbox.combine(data.psup, scriptspace, u);\n        bbox.combine(data.psub, scriptspace, v);\n      }\n\n      bbox.append(data.base);\n\n      if (data.numScripts) {\n        var w = bbox.w;\n        bbox.combine(data.sup, w, u);\n        bbox.combine(data.sub, w, v);\n        bbox.w += scriptspace;\n      }\n\n      bbox.clean();\n      this.setChildPWidths(recompute);\n    };\n\n    class_1.prototype.getScriptData = function () {\n      if (this.scriptData) {\n        return this.scriptData;\n      }\n\n      var data = this.scriptData = {\n        base: null,\n        sub: BBox_js_1.BBox.empty(),\n        sup: BBox_js_1.BBox.empty(),\n        psub: BBox_js_1.BBox.empty(),\n        psup: BBox_js_1.BBox.empty(),\n        numPrescripts: 0,\n        numScripts: 0\n      };\n      var lists = this.getScriptBBoxLists();\n      this.combineBBoxLists(data.sub, data.sup, lists.subList, lists.supList);\n      this.combineBBoxLists(data.psub, data.psup, lists.psubList, lists.psupList);\n      this.scriptData.base = lists.base[0];\n      this.scriptData.numPrescripts = lists.psubList.length;\n      this.scriptData.numScripts = lists.subList.length;\n      return this.scriptData;\n    };\n\n    class_1.prototype.getScriptBBoxLists = function () {\n      var e_1, _a;\n\n      var lists = {\n        base: [],\n        subList: [],\n        supList: [],\n        psubList: [],\n        psupList: []\n      };\n      var script = 'base';\n\n      try {\n        for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n\n          if (child.node.isKind('mprescripts')) {\n            script = 'psubList';\n          } else {\n            lists[script].push(child.getBBox());\n            script = exports.NextScript[script];\n          }\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n\n      this.firstPrescript = lists.subList.length + lists.supList.length + 2;\n      this.padLists(lists.subList, lists.supList);\n      this.padLists(lists.psubList, lists.psupList);\n      return lists;\n    };\n\n    class_1.prototype.padLists = function (list1, list2) {\n      if (list1.length > list2.length) {\n        list2.push(BBox_js_1.BBox.empty());\n      }\n    };\n\n    class_1.prototype.combineBBoxLists = function (bbox1, bbox2, list1, list2) {\n      for (var i = 0; i < list1.length; i++) {\n        var _a = __read(this.getScaledWHD(list1[i]), 3),\n            w1 = _a[0],\n            h1 = _a[1],\n            d1 = _a[2];\n\n        var _b = __read(this.getScaledWHD(list2[i]), 3),\n            w2 = _b[0],\n            h2 = _b[1],\n            d2 = _b[2];\n\n        var w = Math.max(w1, w2);\n        bbox1.w += w;\n        bbox2.w += w;\n        if (h1 > bbox1.h) bbox1.h = h1;\n        if (d1 > bbox1.d) bbox1.d = d1;\n        if (h2 > bbox2.h) bbox2.h = h2;\n        if (d2 > bbox2.d) bbox2.d = d2;\n      }\n    };\n\n    class_1.prototype.getScaledWHD = function (bbox) {\n      var w = bbox.w,\n          h = bbox.h,\n          d = bbox.d,\n          rscale = bbox.rscale;\n      return [w * rscale, h * rscale, d * rscale];\n    };\n\n    class_1.prototype.getUVQ = function (basebox, subbox, supbox) {\n      var _a;\n\n      if (!this.UVQ) {\n        var _b = __read([0, 0, 0], 3),\n            u = _b[0],\n            v = _b[1],\n            q = _b[2];\n\n        if (subbox.h === 0 && subbox.d === 0) {\n          u = this.getU(basebox, supbox);\n        } else if (supbox.h === 0 && supbox.d === 0) {\n          u = -this.getV(basebox, subbox);\n        } else {\n          _a = __read(_super.prototype.getUVQ.call(this, basebox, subbox, supbox), 3), u = _a[0], v = _a[1], q = _a[2];\n        }\n\n        this.UVQ = [u, v, q];\n      }\n\n      return this.UVQ;\n    };\n\n    return class_1;\n  }(Base);\n}\n\nexports.CommonMmultiscriptsMixin = CommonMmultiscriptsMixin;","map":{"version":3,"sources":["../../../../ts/output/common/Wrappers/mmultiscripts.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CommonMmultiscriptsMixin = exports.ScriptNames = exports.NextScript = void 0;\nvar BBox_js_1 = require(\"../../../util/BBox.js\");\nexports.NextScript = {\n    base: 'subList',\n    subList: 'supList',\n    supList: 'subList',\n    psubList: 'psupList',\n    psupList: 'psubList',\n};\nexports.ScriptNames = ['sup', 'sup', 'psup', 'psub'];\nfunction CommonMmultiscriptsMixin(Base) {\n    return (function (_super) {\n        __extends(class_1, _super);\n        function class_1() {\n            var _this = _super !== null && _super.apply(this, arguments) || this;\n            _this.scriptData = null;\n            _this.firstPrescript = 0;\n            return _this;\n        }\n        class_1.prototype.combinePrePost = function (pre, post) {\n            var bbox = new BBox_js_1.BBox(pre);\n            bbox.combine(post, 0, 0);\n            return bbox;\n        };\n        class_1.prototype.computeBBox = function (bbox, recompute) {\n            if (recompute === void 0) { recompute = false; }\n            var scriptspace = this.font.params.scriptspace;\n            var data = this.getScriptData();\n            var sub = this.combinePrePost(data.sub, data.psub);\n            var sup = this.combinePrePost(data.sup, data.psup);\n            var _a = __read(this.getUVQ(data.base, sub, sup), 2), u = _a[0], v = _a[1];\n            bbox.empty();\n            if (data.numPrescripts) {\n                bbox.combine(data.psup, scriptspace, u);\n                bbox.combine(data.psub, scriptspace, v);\n            }\n            bbox.append(data.base);\n            if (data.numScripts) {\n                var w = bbox.w;\n                bbox.combine(data.sup, w, u);\n                bbox.combine(data.sub, w, v);\n                bbox.w += scriptspace;\n            }\n            bbox.clean();\n            this.setChildPWidths(recompute);\n        };\n        class_1.prototype.getScriptData = function () {\n            if (this.scriptData) {\n                return this.scriptData;\n            }\n            var data = this.scriptData = {\n                base: null, sub: BBox_js_1.BBox.empty(), sup: BBox_js_1.BBox.empty(), psub: BBox_js_1.BBox.empty(), psup: BBox_js_1.BBox.empty(),\n                numPrescripts: 0, numScripts: 0\n            };\n            var lists = this.getScriptBBoxLists();\n            this.combineBBoxLists(data.sub, data.sup, lists.subList, lists.supList);\n            this.combineBBoxLists(data.psub, data.psup, lists.psubList, lists.psupList);\n            this.scriptData.base = lists.base[0];\n            this.scriptData.numPrescripts = lists.psubList.length;\n            this.scriptData.numScripts = lists.subList.length;\n            return this.scriptData;\n        };\n        class_1.prototype.getScriptBBoxLists = function () {\n            var e_1, _a;\n            var lists = {\n                base: [], subList: [], supList: [], psubList: [], psupList: []\n            };\n            var script = 'base';\n            try {\n                for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                    var child = _c.value;\n                    if (child.node.isKind('mprescripts')) {\n                        script = 'psubList';\n                    }\n                    else {\n                        lists[script].push(child.getBBox());\n                        script = exports.NextScript[script];\n                    }\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n            this.firstPrescript = lists.subList.length + lists.supList.length + 2;\n            this.padLists(lists.subList, lists.supList);\n            this.padLists(lists.psubList, lists.psupList);\n            return lists;\n        };\n        class_1.prototype.padLists = function (list1, list2) {\n            if (list1.length > list2.length) {\n                list2.push(BBox_js_1.BBox.empty());\n            }\n        };\n        class_1.prototype.combineBBoxLists = function (bbox1, bbox2, list1, list2) {\n            for (var i = 0; i < list1.length; i++) {\n                var _a = __read(this.getScaledWHD(list1[i]), 3), w1 = _a[0], h1 = _a[1], d1 = _a[2];\n                var _b = __read(this.getScaledWHD(list2[i]), 3), w2 = _b[0], h2 = _b[1], d2 = _b[2];\n                var w = Math.max(w1, w2);\n                bbox1.w += w;\n                bbox2.w += w;\n                if (h1 > bbox1.h)\n                    bbox1.h = h1;\n                if (d1 > bbox1.d)\n                    bbox1.d = d1;\n                if (h2 > bbox2.h)\n                    bbox2.h = h2;\n                if (d2 > bbox2.d)\n                    bbox2.d = d2;\n            }\n        };\n        class_1.prototype.getScaledWHD = function (bbox) {\n            var w = bbox.w, h = bbox.h, d = bbox.d, rscale = bbox.rscale;\n            return [w * rscale, h * rscale, d * rscale];\n        };\n        class_1.prototype.getUVQ = function (basebox, subbox, supbox) {\n            var _a;\n            if (!this.UVQ) {\n                var _b = __read([0, 0, 0], 3), u = _b[0], v = _b[1], q = _b[2];\n                if (subbox.h === 0 && subbox.d === 0) {\n                    u = this.getU(basebox, supbox);\n                }\n                else if (supbox.h === 0 && supbox.d === 0) {\n                    u = -this.getV(basebox, subbox);\n                }\n                else {\n                    _a = __read(_super.prototype.getUVQ.call(this, basebox, subbox, supbox), 3), u = _a[0], v = _a[1], q = _a[2];\n                }\n                this.UVQ = [u, v, q];\n            }\n            return this.UVQ;\n        };\n        return class_1;\n    }(Base));\n}\nexports.CommonMmultiscriptsMixin = CommonMmultiscriptsMixin;\n//# sourceMappingURL=mmultiscripts.js.map"]},"metadata":{},"sourceType":"script"}